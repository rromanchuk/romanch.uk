<<<<<<< HEAD:personal/vendor/javascript/three--examples--jsm--controls--OrbitControls.js.js
import{Ray as e,Plane as t,MathUtils as o,EventDispatcher as n,Vector3 as a,MOUSE as i,TOUCH as s,Quaternion as r,Spherical as c,Vector2 as l}from"three";const u={type:"change"};const d={type:"start"};const h={type:"end"};const m=new e;const p=new t;const f=Math.cos(70*o.DEG2RAD);class OrbitControls extends n{constructor(e,t){super();this.object=e;this.domElement=t;this.domElement.style.touchAction="none";this.enabled=true;this.target=new a;this.cursor=new a;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minTargetRadius=0;this.maxTargetRadius=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=false;this.dampingFactor=.05;this.enableZoom=true;this.zoomSpeed=1;this.enableRotate=true;this.rotateSpeed=1;this.enablePan=true;this.panSpeed=1;this.screenSpacePanning=true;this.keyPanSpeed=7;this.zoomToCursor=false;this.autoRotate=false;this.autoRotateSpeed=2;this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"};this.mouseButtons={LEFT:i.ROTATE,MIDDLE:i.DOLLY,RIGHT:i.PAN};this.touches={ONE:s.ROTATE,TWO:s.DOLLY_PAN};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this._domElementKeyEvents=null;this.getPolarAngle=function(){return g.phi};this.getAzimuthalAngle=function(){return g.theta};this.getDistance=function(){return this.object.position.distanceTo(this.target)};this.listenToKeyEvents=function(e){e.addEventListener("keydown",onKeyDown);this._domElementKeyEvents=e};this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",onKeyDown);this._domElementKeyEvents=null};this.saveState=function(){o.target0.copy(o.target);o.position0.copy(o.object.position);o.zoom0=o.object.zoom};this.reset=function(){o.target.copy(o.target0);o.object.position.copy(o.position0);o.object.zoom=o.zoom0;o.object.updateProjectionMatrix();o.dispatchEvent(u);o.update();b=n.NONE};this.update=function(){const t=new a;const i=(new r).setFromUnitVectors(e.up,new a(0,1,0));const s=i.clone().invert();const c=new a;const l=new r;const d=new a;const h=2*Math.PI;return function update(r=null){const M=o.object.position;t.copy(M).sub(o.target);t.applyQuaternion(i);g.setFromVector3(t);o.autoRotate&&b===n.NONE&&rotateLeft(getAutoRotationAngle(r));if(o.enableDamping){g.theta+=P.theta*o.dampingFactor;g.phi+=P.phi*o.dampingFactor}else{g.theta+=P.theta;g.phi+=P.phi}let v=o.minAzimuthAngle;let w=o.maxAzimuthAngle;if(isFinite(v)&&isFinite(w)){v<-Math.PI?v+=h:v>Math.PI&&(v-=h);w<-Math.PI?w+=h:w>Math.PI&&(w-=h);g.theta=v<=w?Math.max(v,Math.min(w,g.theta)):g.theta>(v+w)/2?Math.max(v,g.theta):Math.min(w,g.theta)}g.phi=Math.max(o.minPolarAngle,Math.min(o.maxPolarAngle,g.phi));g.makeSafe();o.enableDamping===true?o.target.addScaledVector(T,o.dampingFactor):o.target.add(T);o.target.sub(o.cursor);o.target.clampLength(o.minTargetRadius,o.maxTargetRadius);o.target.add(o.cursor);let D=false;if(o.zoomToCursor&&N||o.object.isOrthographicCamera)g.radius=clampDistance(g.radius);else{const e=g.radius;g.radius=clampDistance(g.radius*E);D=e!=g.radius}t.setFromSpherical(g);t.applyQuaternion(s);M.copy(o.target).add(t);o.object.lookAt(o.target);if(o.enableDamping===true){P.theta*=1-o.dampingFactor;P.phi*=1-o.dampingFactor;T.multiplyScalar(1-o.dampingFactor)}else{P.set(0,0,0);T.set(0,0,0)}if(o.zoomToCursor&&N){let n=null;if(o.object.isPerspectiveCamera){const e=t.length();n=clampDistance(e*E);const a=e-n;o.object.position.addScaledVector(A,a);o.object.updateMatrixWorld();D=!!a}else if(o.object.isOrthographicCamera){const e=new a(k.x,k.y,0);e.unproject(o.object);const i=o.object.zoom;o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/E));o.object.updateProjectionMatrix();D=i!==o.object.zoom;const s=new a(k.x,k.y,0);s.unproject(o.object);o.object.position.sub(s).add(e);o.object.updateMatrixWorld();n=t.length()}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled.");o.zoomToCursor=false}if(n!==null)if(this.screenSpacePanning)o.target.set(0,0,-1).transformDirection(o.object.matrix).multiplyScalar(n).add(o.object.position);else{m.origin.copy(o.object.position);m.direction.set(0,0,-1).transformDirection(o.object.matrix);if(Math.abs(o.object.up.dot(m.direction))<f)e.lookAt(o.target);else{p.setFromNormalAndCoplanarPoint(o.object.up,o.target);m.intersectPlane(p,o.target)}}}else if(o.object.isOrthographicCamera){const e=o.object.zoom;o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/E));if(e!==o.object.zoom){o.object.updateProjectionMatrix();D=true}}E=1;N=false;if(D||c.distanceToSquared(o.object.position)>y||8*(1-l.dot(o.object.quaternion))>y||d.distanceToSquared(o.target)>y){o.dispatchEvent(u);c.copy(o.object.position);l.copy(o.object.quaternion);d.copy(o.target);return true}return false}}();this.dispose=function(){o.domElement.removeEventListener("contextmenu",onContextMenu);o.domElement.removeEventListener("pointerdown",onPointerDown);o.domElement.removeEventListener("pointercancel",onPointerUp);o.domElement.removeEventListener("wheel",onMouseWheel);o.domElement.removeEventListener("pointermove",onPointerMove);o.domElement.removeEventListener("pointerup",onPointerUp);const e=o.domElement.getRootNode();e.removeEventListener("keydown",interceptControlDown,{capture:true});if(o._domElementKeyEvents!==null){o._domElementKeyEvents.removeEventListener("keydown",onKeyDown);o._domElementKeyEvents=null}};const o=this;const n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let b=n.NONE;const y=1e-6;const g=new c;const P=new c;let E=1;const T=new a;const M=new l;const v=new l;const w=new l;const D=new l;const O=new l;const j=new l;const S=new l;const R=new l;const L=new l;const A=new a;const k=new l;let N=false;const x=[];const C={};let I=false;function getAutoRotationAngle(e){return e!==null?2*Math.PI/60*o.autoRotateSpeed*e:2*Math.PI/60/60*o.autoRotateSpeed}function getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,o.zoomSpeed*t)}function rotateLeft(e){P.theta-=e}function rotateUp(e){P.phi-=e}const Y=function(){const e=new a;return function panLeft(t,o){e.setFromMatrixColumn(o,0);e.multiplyScalar(-t);T.add(e)}}();const K=function(){const e=new a;return function panUp(t,n){if(o.screenSpacePanning===true)e.setFromMatrixColumn(n,1);else{e.setFromMatrixColumn(n,0);e.crossVectors(o.object.up,e)}e.multiplyScalar(t);T.add(e)}}();const z=function(){const e=new a;return function pan(t,n){const a=o.domElement;if(o.object.isPerspectiveCamera){const i=o.object.position;e.copy(i).sub(o.target);let s=e.length();s*=Math.tan(o.object.fov/2*Math.PI/180);Y(2*t*s/a.clientHeight,o.object.matrix);K(2*n*s/a.clientHeight,o.object.matrix)}else if(o.object.isOrthographicCamera){Y(t*(o.object.right-o.object.left)/o.object.zoom/a.clientWidth,o.object.matrix);K(n*(o.object.top-o.object.bottom)/o.object.zoom/a.clientHeight,o.object.matrix)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.");o.enablePan=false}}}();function dollyOut(e){if(o.object.isPerspectiveCamera||o.object.isOrthographicCamera)E/=e;else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.");o.enableZoom=false}}function dollyIn(e){if(o.object.isPerspectiveCamera||o.object.isOrthographicCamera)E*=e;else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.");o.enableZoom=false}}function updateZoomParameters(e,t){if(!o.zoomToCursor)return;N=true;const n=o.domElement.getBoundingClientRect();const a=e-n.left;const i=t-n.top;const s=n.width;const r=n.height;k.x=a/s*2-1;k.y=-i/r*2+1;A.set(k.x,k.y,1).unproject(o.object).sub(o.object.position).normalize()}function clampDistance(e){return Math.max(o.minDistance,Math.min(o.maxDistance,e))}function handleMouseDownRotate(e){M.set(e.clientX,e.clientY)}function handleMouseDownDolly(e){updateZoomParameters(e.clientX,e.clientX);S.set(e.clientX,e.clientY)}function handleMouseDownPan(e){D.set(e.clientX,e.clientY)}function handleMouseMoveRotate(e){v.set(e.clientX,e.clientY);w.subVectors(v,M).multiplyScalar(o.rotateSpeed);const t=o.domElement;rotateLeft(2*Math.PI*w.x/t.clientHeight);rotateUp(2*Math.PI*w.y/t.clientHeight);M.copy(v);o.update()}function handleMouseMoveDolly(e){R.set(e.clientX,e.clientY);L.subVectors(R,S);L.y>0?dollyOut(getZoomScale(L.y)):L.y<0&&dollyIn(getZoomScale(L.y));S.copy(R);o.update()}function handleMouseMovePan(e){O.set(e.clientX,e.clientY);j.subVectors(O,D).multiplyScalar(o.panSpeed);z(j.x,j.y);D.copy(O);o.update()}function handleMouseWheel(e){updateZoomParameters(e.clientX,e.clientY);e.deltaY<0?dollyIn(getZoomScale(e.deltaY)):e.deltaY>0&&dollyOut(getZoomScale(e.deltaY));o.update()}function handleKeyDown(e){let t=false;switch(e.code){case o.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?rotateUp(2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):z(0,o.keyPanSpeed);t=true;break;case o.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?rotateUp(-2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):z(0,-o.keyPanSpeed);t=true;break;case o.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?rotateLeft(2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):z(o.keyPanSpeed,0);t=true;break;case o.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?rotateLeft(-2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):z(-o.keyPanSpeed,0);t=true;break}if(t){e.preventDefault();o.update()}}function handleTouchStartRotate(e){if(x.length===1)M.set(e.pageX,e.pageY);else{const t=getSecondPointerPosition(e);const o=.5*(e.pageX+t.x);const n=.5*(e.pageY+t.y);M.set(o,n)}}function handleTouchStartPan(e){if(x.length===1)D.set(e.pageX,e.pageY);else{const t=getSecondPointerPosition(e);const o=.5*(e.pageX+t.x);const n=.5*(e.pageY+t.y);D.set(o,n)}}function handleTouchStartDolly(e){const t=getSecondPointerPosition(e);const o=e.pageX-t.x;const n=e.pageY-t.y;const a=Math.sqrt(o*o+n*n);S.set(0,a)}function handleTouchStartDollyPan(e){o.enableZoom&&handleTouchStartDolly(e);o.enablePan&&handleTouchStartPan(e)}function handleTouchStartDollyRotate(e){o.enableZoom&&handleTouchStartDolly(e);o.enableRotate&&handleTouchStartRotate(e)}function handleTouchMoveRotate(e){if(x.length==1)v.set(e.pageX,e.pageY);else{const t=getSecondPointerPosition(e);const o=.5*(e.pageX+t.x);const n=.5*(e.pageY+t.y);v.set(o,n)}w.subVectors(v,M).multiplyScalar(o.rotateSpeed);const t=o.domElement;rotateLeft(2*Math.PI*w.x/t.clientHeight);rotateUp(2*Math.PI*w.y/t.clientHeight);M.copy(v)}function handleTouchMovePan(e){if(x.length===1)O.set(e.pageX,e.pageY);else{const t=getSecondPointerPosition(e);const o=.5*(e.pageX+t.x);const n=.5*(e.pageY+t.y);O.set(o,n)}j.subVectors(O,D).multiplyScalar(o.panSpeed);z(j.x,j.y);D.copy(O)}function handleTouchMoveDolly(e){const t=getSecondPointerPosition(e);const n=e.pageX-t.x;const a=e.pageY-t.y;const i=Math.sqrt(n*n+a*a);R.set(0,i);L.set(0,Math.pow(R.y/S.y,o.zoomSpeed));dollyOut(L.y);S.copy(R);const s=(e.pageX+t.x)*.5;const r=(e.pageY+t.y)*.5;updateZoomParameters(s,r)}function handleTouchMoveDollyPan(e){o.enableZoom&&handleTouchMoveDolly(e);o.enablePan&&handleTouchMovePan(e)}function handleTouchMoveDollyRotate(e){o.enableZoom&&handleTouchMoveDolly(e);o.enableRotate&&handleTouchMoveRotate(e)}function onPointerDown(e){if(o.enabled!==false){if(x.length===0){o.domElement.setPointerCapture(e.pointerId);o.domElement.addEventListener("pointermove",onPointerMove);o.domElement.addEventListener("pointerup",onPointerUp)}if(!isTrackingPointer(e)){addPointer(e);e.pointerType==="touch"?onTouchStart(e):onMouseDown(e)}}}function onPointerMove(e){o.enabled!==false&&(e.pointerType==="touch"?onTouchMove(e):onMouseMove(e))}function onPointerUp(e){removePointer(e);switch(x.length){case 0:o.domElement.releasePointerCapture(e.pointerId);o.domElement.removeEventListener("pointermove",onPointerMove);o.domElement.removeEventListener("pointerup",onPointerUp);o.dispatchEvent(h);b=n.NONE;break;case 1:const t=x[0];const a=C[t];onTouchStart({pointerId:t,pageX:a.x,pageY:a.y});break}}function onMouseDown(e){let t;switch(e.button){case 0:t=o.mouseButtons.LEFT;break;case 1:t=o.mouseButtons.MIDDLE;break;case 2:t=o.mouseButtons.RIGHT;break;default:t=-1}switch(t){case i.DOLLY:if(o.enableZoom===false)return;handleMouseDownDolly(e);b=n.DOLLY;break;case i.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(o.enablePan===false)return;handleMouseDownPan(e);b=n.PAN}else{if(o.enableRotate===false)return;handleMouseDownRotate(e);b=n.ROTATE}break;case i.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(o.enableRotate===false)return;handleMouseDownRotate(e);b=n.ROTATE}else{if(o.enablePan===false)return;handleMouseDownPan(e);b=n.PAN}break;default:b=n.NONE}b!==n.NONE&&o.dispatchEvent(d)}function onMouseMove(e){switch(b){case n.ROTATE:if(o.enableRotate===false)return;handleMouseMoveRotate(e);break;case n.DOLLY:if(o.enableZoom===false)return;handleMouseMoveDolly(e);break;case n.PAN:if(o.enablePan===false)return;handleMouseMovePan(e);break}}function onMouseWheel(e){if(o.enabled!==false&&o.enableZoom!==false&&b===n.NONE){e.preventDefault();o.dispatchEvent(d);handleMouseWheel(customWheelEvent(e));o.dispatchEvent(h)}}function customWheelEvent(e){const t=e.deltaMode;const o={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:o.deltaY*=16;break;case 2:o.deltaY*=100;break}e.ctrlKey&&!I&&(o.deltaY*=10);return o}function interceptControlDown(e){if(e.key==="Control"){I=true;const e=o.domElement.getRootNode();e.addEventListener("keyup",interceptControlUp,{passive:true,capture:true})}}function interceptControlUp(e){if(e.key==="Control"){I=false;const e=o.domElement.getRootNode();e.removeEventListener("keyup",interceptControlUp,{passive:true,capture:true})}}function onKeyDown(e){o.enabled!==false&&o.enablePan!==false&&handleKeyDown(e)}function onTouchStart(e){trackPointer(e);switch(x.length){case 1:switch(o.touches.ONE){case s.ROTATE:if(o.enableRotate===false)return;handleTouchStartRotate(e);b=n.TOUCH_ROTATE;break;case s.PAN:if(o.enablePan===false)return;handleTouchStartPan(e);b=n.TOUCH_PAN;break;default:b=n.NONE}break;case 2:switch(o.touches.TWO){case s.DOLLY_PAN:if(o.enableZoom===false&&o.enablePan===false)return;handleTouchStartDollyPan(e);b=n.TOUCH_DOLLY_PAN;break;case s.DOLLY_ROTATE:if(o.enableZoom===false&&o.enableRotate===false)return;handleTouchStartDollyRotate(e);b=n.TOUCH_DOLLY_ROTATE;break;default:b=n.NONE}break;default:b=n.NONE}b!==n.NONE&&o.dispatchEvent(d)}function onTouchMove(e){trackPointer(e);switch(b){case n.TOUCH_ROTATE:if(o.enableRotate===false)return;handleTouchMoveRotate(e);o.update();break;case n.TOUCH_PAN:if(o.enablePan===false)return;handleTouchMovePan(e);o.update();break;case n.TOUCH_DOLLY_PAN:if(o.enableZoom===false&&o.enablePan===false)return;handleTouchMoveDollyPan(e);o.update();break;case n.TOUCH_DOLLY_ROTATE:if(o.enableZoom===false&&o.enableRotate===false)return;handleTouchMoveDollyRotate(e);o.update();break;default:b=n.NONE}}function onContextMenu(e){o.enabled!==false&&e.preventDefault()}function addPointer(e){x.push(e.pointerId)}function removePointer(e){delete C[e.pointerId];for(let t=0;t<x.length;t++)if(x[t]==e.pointerId){x.splice(t,1);return}}function isTrackingPointer(e){for(let t=0;t<x.length;t++)if(x[t]==e.pointerId)return true;return false}function trackPointer(e){let t=C[e.pointerId];if(t===void 0){t=new l;C[e.pointerId]=t}t.set(e.pageX,e.pageY)}function getSecondPointerPosition(e){const t=e.pointerId===x[0]?x[1]:x[0];return C[t]}o.domElement.addEventListener("contextmenu",onContextMenu);o.domElement.addEventListener("pointerdown",onPointerDown);o.domElement.addEventListener("pointercancel",onPointerUp);o.domElement.addEventListener("wheel",onMouseWheel,{passive:false});const U=o.domElement.getRootNode();U.addEventListener("keydown",interceptControlDown,{passive:true,capture:true});this.update()}}export{OrbitControls};
=======
// three/examples/jsm/controls/OrbitControls.js@0.172.0 downloaded from https://ga.jspm.io/npm:three@0.172.0/examples/jsm/controls/OrbitControls.js

import{Ray as t,Plane as e,MathUtils as s,Vector3 as i,Controls as o,MOUSE as n,TOUCH as a,Quaternion as h,Spherical as r,Vector2 as l}from"three";const c={type:"change"};const p={type:"start"};const _={type:"end"};const d=new t;const u=new e;const m=Math.cos(70*s.DEG2RAD);const b=new i;const y=2*Math.PI;const f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};const g=1e-6;class OrbitControls extends o{constructor(t,e=null){super(t,e);this.state=f.NONE;this.enabled=true;this.target=new i;this.cursor=new i;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minTargetRadius=0;this.maxTargetRadius=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=false;this.dampingFactor=.05;this.enableZoom=true;this.zoomSpeed=1;this.enableRotate=true;this.rotateSpeed=1;this.keyRotateSpeed=1;this.enablePan=true;this.panSpeed=1;this.screenSpacePanning=true;this.keyPanSpeed=7;this.zoomToCursor=false;this.autoRotate=false;this.autoRotateSpeed=2;this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"};this.mouseButtons={LEFT:n.ROTATE,MIDDLE:n.DOLLY,RIGHT:n.PAN};this.touches={ONE:a.ROTATE,TWO:a.DOLLY_PAN};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this._domElementKeyEvents=null;this._lastPosition=new i;this._lastQuaternion=new h;this._lastTargetPosition=new i;this._quat=(new h).setFromUnitVectors(t.up,new i(0,1,0));this._quatInverse=this._quat.clone().invert();this._spherical=new r;this._sphericalDelta=new r;this._scale=1;this._panOffset=new i;this._rotateStart=new l;this._rotateEnd=new l;this._rotateDelta=new l;this._panStart=new l;this._panEnd=new l;this._panDelta=new l;this._dollyStart=new l;this._dollyEnd=new l;this._dollyDelta=new l;this._dollyDirection=new i;this._mouse=new l;this._performCursorZoom=false;this._pointers=[];this._pointerPositions={};this._controlActive=false;this._onPointerMove=onPointerMove.bind(this);this._onPointerDown=onPointerDown.bind(this);this._onPointerUp=onPointerUp.bind(this);this._onContextMenu=onContextMenu.bind(this);this._onMouseWheel=onMouseWheel.bind(this);this._onKeyDown=onKeyDown.bind(this);this._onTouchStart=onTouchStart.bind(this);this._onTouchMove=onTouchMove.bind(this);this._onMouseDown=onMouseDown.bind(this);this._onMouseMove=onMouseMove.bind(this);this._interceptControlDown=interceptControlDown.bind(this);this._interceptControlUp=interceptControlUp.bind(this);this.domElement!==null&&this.connect();this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown);this.domElement.addEventListener("pointercancel",this._onPointerUp);this.domElement.addEventListener("contextmenu",this._onContextMenu);this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:false});const t=this.domElement.getRootNode();t.addEventListener("keydown",this._interceptControlDown,{passive:true,capture:true});this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown);this.domElement.removeEventListener("pointermove",this._onPointerMove);this.domElement.removeEventListener("pointerup",this._onPointerUp);this.domElement.removeEventListener("pointercancel",this._onPointerUp);this.domElement.removeEventListener("wheel",this._onMouseWheel);this.domElement.removeEventListener("contextmenu",this._onContextMenu);this.stopListenToKeyEvents();const t=this.domElement.getRootNode();t.removeEventListener("keydown",this._interceptControlDown,{capture:true});this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown);this._domElementKeyEvents=t}stopListenToKeyEvents(){if(this._domElementKeyEvents!==null){this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown);this._domElementKeyEvents=null}}saveState(){this.target0.copy(this.target);this.position0.copy(this.object.position);this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0);this.object.position.copy(this.position0);this.object.zoom=this.zoom0;this.object.updateProjectionMatrix();this.dispatchEvent(c);this.update();this.state=f.NONE}update(t=null){const e=this.object.position;b.copy(e).sub(this.target);b.applyQuaternion(this._quat);this._spherical.setFromVector3(b);this.autoRotate&&this.state===f.NONE&&this._rotateLeft(this._getAutoRotationAngle(t));if(this.enableDamping){this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor;this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor}else{this._spherical.theta+=this._sphericalDelta.theta;this._spherical.phi+=this._sphericalDelta.phi}let s=this.minAzimuthAngle;let o=this.maxAzimuthAngle;if(isFinite(s)&&isFinite(o)){s<-Math.PI?s+=y:s>Math.PI&&(s-=y);o<-Math.PI?o+=y:o>Math.PI&&(o-=y);this._spherical.theta=s<=o?Math.max(s,Math.min(o,this._spherical.theta)):this._spherical.theta>(s+o)/2?Math.max(s,this._spherical.theta):Math.min(o,this._spherical.theta)}this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi));this._spherical.makeSafe();this.enableDamping===true?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset);this.target.sub(this.cursor);this.target.clampLength(this.minTargetRadius,this.maxTargetRadius);this.target.add(this.cursor);let n=false;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const t=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale);n=t!=this._spherical.radius}b.setFromSpherical(this._spherical);b.applyQuaternion(this._quatInverse);e.copy(this.target).add(b);this.object.lookAt(this.target);if(this.enableDamping===true){this._sphericalDelta.theta*=1-this.dampingFactor;this._sphericalDelta.phi*=1-this.dampingFactor;this._panOffset.multiplyScalar(1-this.dampingFactor)}else{this._sphericalDelta.set(0,0,0);this._panOffset.set(0,0,0)}if(this.zoomToCursor&&this._performCursorZoom){let t=null;if(this.object.isPerspectiveCamera){const e=b.length();t=this._clampDistance(e*this._scale);const s=e-t;this.object.position.addScaledVector(this._dollyDirection,s);this.object.updateMatrixWorld();n=!!s}else if(this.object.isOrthographicCamera){const e=new i(this._mouse.x,this._mouse.y,0);e.unproject(this.object);const s=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale));this.object.updateProjectionMatrix();n=s!==this.object.zoom;const o=new i(this._mouse.x,this._mouse.y,0);o.unproject(this.object);this.object.position.sub(o).add(e);this.object.updateMatrixWorld();t=b.length()}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled.");this.zoomToCursor=false}if(t!==null)if(this.screenSpacePanning)this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(t).add(this.object.position);else{d.origin.copy(this.object.position);d.direction.set(0,0,-1).transformDirection(this.object.matrix);if(Math.abs(this.object.up.dot(d.direction))<m)this.object.lookAt(this.target);else{u.setFromNormalAndCoplanarPoint(this.object.up,this.target);d.intersectPlane(u,this.target)}}}else if(this.object.isOrthographicCamera){const t=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale));if(t!==this.object.zoom){this.object.updateProjectionMatrix();n=true}}this._scale=1;this._performCursorZoom=false;if(n||this._lastPosition.distanceToSquared(this.object.position)>g||8*(1-this._lastQuaternion.dot(this.object.quaternion))>g||this._lastTargetPosition.distanceToSquared(this.target)>g){this.dispatchEvent(c);this._lastPosition.copy(this.object.position);this._lastQuaternion.copy(this.object.quaternion);this._lastTargetPosition.copy(this.target);return true}return false}_getAutoRotationAngle(t){return t!==null?y/60*this.autoRotateSpeed*t:y/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){b.setFromMatrixColumn(e,0);b.multiplyScalar(-t);this._panOffset.add(b)}_panUp(t,e){if(this.screenSpacePanning===true)b.setFromMatrixColumn(e,1);else{b.setFromMatrixColumn(e,0);b.crossVectors(this.object.up,b)}b.multiplyScalar(t);this._panOffset.add(b)}_pan(t,e){const s=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;b.copy(i).sub(this.target);let o=b.length();o*=Math.tan(this.object.fov/2*Math.PI/180);this._panLeft(2*t*o/s.clientHeight,this.object.matrix);this._panUp(2*e*o/s.clientHeight,this.object.matrix)}else if(this.object.isOrthographicCamera){this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix);this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.");this.enablePan=false}}_dollyOut(t){if(this.object.isPerspectiveCamera||this.object.isOrthographicCamera)this._scale/=t;else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.");this.enableZoom=false}}_dollyIn(t){if(this.object.isPerspectiveCamera||this.object.isOrthographicCamera)this._scale*=t;else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.");this.enableZoom=false}}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=true;const s=this.domElement.getBoundingClientRect();const i=t-s.left;const o=e-s.top;const n=s.width;const a=s.height;this._mouse.x=i/n*2-1;this._mouse.y=-o/a*2+1;this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX);this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY);this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(y*this._rotateDelta.x/e.clientHeight);this._rotateUp(y*this._rotateDelta.y/e.clientHeight);this._rotateStart.copy(this._rotateEnd);this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY);this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart);this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y));this._dollyStart.copy(this._dollyEnd);this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY);this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed);this._pan(this._panDelta.x,this._panDelta.y);this._panStart.copy(this._panEnd);this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY);t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY));this.update()}_handleKeyDown(t){let e=false;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(y*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed);e=true;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-y*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed);e=true;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(y*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0);e=true;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-y*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0);e=true;break}if(e){t.preventDefault();this.update()}}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t);const s=.5*(t.pageX+e.x);const i=.5*(t.pageY+e.y);this._rotateStart.set(s,i)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t);const s=.5*(t.pageX+e.x);const i=.5*(t.pageY+e.y);this._panStart.set(s,i)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t);const s=t.pageX-e.x;const i=t.pageY-e.y;const o=Math.sqrt(s*s+i*i);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t);this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t);this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t);const s=.5*(t.pageX+e.x);const i=.5*(t.pageY+e.y);this._rotateEnd.set(s,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(y*this._rotateDelta.x/e.clientHeight);this._rotateUp(y*this._rotateDelta.y/e.clientHeight);this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t);const s=.5*(t.pageX+e.x);const i=.5*(t.pageY+e.y);this._panEnd.set(s,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed);this._pan(this._panDelta.x,this._panDelta.y);this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t);const s=t.pageX-e.x;const i=t.pageY-e.y;const o=Math.sqrt(s*s+i*i);this._dollyEnd.set(0,o);this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed));this._dollyOut(this._dollyDelta.y);this._dollyStart.copy(this._dollyEnd);const n=(t.pageX+e.x)*.5;const a=(t.pageY+e.y)*.5;this._updateZoomParameters(n,a)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t);this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t);this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId){this._pointers.splice(e,1);return}}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return true;return false}_trackPointer(t){let e=this._pointerPositions[t.pointerId];if(e===void 0){e=new l;this._pointerPositions[t.pointerId]=e}e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode;const s={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}t.ctrlKey&&!this._controlActive&&(s.deltaY*=10);return s}}function onPointerDown(t){if(this.enabled!==false){if(this._pointers.length===0){this.domElement.setPointerCapture(t.pointerId);this.domElement.addEventListener("pointermove",this._onPointerMove);this.domElement.addEventListener("pointerup",this._onPointerUp)}if(!this._isTrackingPointer(t)){this._addPointer(t);t.pointerType==="touch"?this._onTouchStart(t):this._onMouseDown(t)}}}function onPointerMove(t){this.enabled!==false&&(t.pointerType==="touch"?this._onTouchMove(t):this._onMouseMove(t))}function onPointerUp(t){this._removePointer(t);switch(this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId);this.domElement.removeEventListener("pointermove",this._onPointerMove);this.domElement.removeEventListener("pointerup",this._onPointerUp);this.dispatchEvent(_);this.state=f.NONE;break;case 1:const e=this._pointers[0];const s=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:s.x,pageY:s.y});break}}function onMouseDown(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case n.DOLLY:if(this.enableZoom===false)return;this._handleMouseDownDolly(t);this.state=f.DOLLY;break;case n.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===false)return;this._handleMouseDownPan(t);this.state=f.PAN}else{if(this.enableRotate===false)return;this._handleMouseDownRotate(t);this.state=f.ROTATE}break;case n.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===false)return;this._handleMouseDownRotate(t);this.state=f.ROTATE}else{if(this.enablePan===false)return;this._handleMouseDownPan(t);this.state=f.PAN}break;default:this.state=f.NONE}this.state!==f.NONE&&this.dispatchEvent(p)}function onMouseMove(t){switch(this.state){case f.ROTATE:if(this.enableRotate===false)return;this._handleMouseMoveRotate(t);break;case f.DOLLY:if(this.enableZoom===false)return;this._handleMouseMoveDolly(t);break;case f.PAN:if(this.enablePan===false)return;this._handleMouseMovePan(t);break}}function onMouseWheel(t){if(this.enabled!==false&&this.enableZoom!==false&&this.state===f.NONE){t.preventDefault();this.dispatchEvent(p);this._handleMouseWheel(this._customWheelEvent(t));this.dispatchEvent(_)}}function onKeyDown(t){this.enabled!==false&&this._handleKeyDown(t)}function onTouchStart(t){this._trackPointer(t);switch(this._pointers.length){case 1:switch(this.touches.ONE){case a.ROTATE:if(this.enableRotate===false)return;this._handleTouchStartRotate(t);this.state=f.TOUCH_ROTATE;break;case a.PAN:if(this.enablePan===false)return;this._handleTouchStartPan(t);this.state=f.TOUCH_PAN;break;default:this.state=f.NONE}break;case 2:switch(this.touches.TWO){case a.DOLLY_PAN:if(this.enableZoom===false&&this.enablePan===false)return;this._handleTouchStartDollyPan(t);this.state=f.TOUCH_DOLLY_PAN;break;case a.DOLLY_ROTATE:if(this.enableZoom===false&&this.enableRotate===false)return;this._handleTouchStartDollyRotate(t);this.state=f.TOUCH_DOLLY_ROTATE;break;default:this.state=f.NONE}break;default:this.state=f.NONE}this.state!==f.NONE&&this.dispatchEvent(p)}function onTouchMove(t){this._trackPointer(t);switch(this.state){case f.TOUCH_ROTATE:if(this.enableRotate===false)return;this._handleTouchMoveRotate(t);this.update();break;case f.TOUCH_PAN:if(this.enablePan===false)return;this._handleTouchMovePan(t);this.update();break;case f.TOUCH_DOLLY_PAN:if(this.enableZoom===false&&this.enablePan===false)return;this._handleTouchMoveDollyPan(t);this.update();break;case f.TOUCH_DOLLY_ROTATE:if(this.enableZoom===false&&this.enableRotate===false)return;this._handleTouchMoveDollyRotate(t);this.update();break;default:this.state=f.NONE}}function onContextMenu(t){this.enabled!==false&&t.preventDefault()}function interceptControlDown(t){if(t.key==="Control"){this._controlActive=true;const t=this.domElement.getRootNode();t.addEventListener("keyup",this._interceptControlUp,{passive:true,capture:true})}}function interceptControlUp(t){if(t.key==="Control"){this._controlActive=false;const t=this.domElement.getRootNode();t.removeEventListener("keyup",this._interceptControlUp,{passive:true,capture:true})}}export{OrbitControls};
>>>>>>> dev:vendor/javascript/three--examples--jsm--controls--OrbitControls.js.js

