var e=function equal(e,t){if(e===t)return true;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return false;var i,r,s;if(Array.isArray(e)){i=e.length;if(i!=t.length)return false;for(r=i;0!==r--;)if(!equal(e[r],t[r]))return false;return true}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();s=Object.keys(e);i=s.length;if(i!==Object.keys(t).length)return false;for(r=i;0!==r--;)if(!Object.prototype.hasOwnProperty.call(t,s[r]))return false;for(r=i;0!==r--;){var a=s[r];if(!equal(e[a],t[a]))return false}return true}return e!==e&&t!==t};const t="__googleMapsScriptId";var i;(function(e){e[e.INITIALIZED=0]="INITIALIZED";e[e.LOADING=1]="LOADING";e[e.SUCCESS=2]="SUCCESS";e[e.FAILURE=3]="FAILURE"})(i||(i={}));class Loader{constructor({apiKey:i,authReferrerPolicy:r,channel:s,client:a,id:o=t,language:n,libraries:l=[],mapIds:h,nonce:c,region:d,retries:u=3,url:g="https://maps.googleapis.com/maps/api/js",version:p}){this.CALLBACK="__googleMapsCallback";this.callbacks=[];this.done=false;this.loading=false;this.errors=[];this.apiKey=i;this.authReferrerPolicy=r;this.channel=s;this.client=a;this.id=o||t;this.language=n;this.libraries=l;this.mapIds=h;this.nonce=c;this.region=d;this.retries=u;this.url=g;this.version=p;if(Loader.instance){if(!e(this.options,Loader.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(Loader.instance.options)}`);return Loader.instance}Loader.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?i.FAILURE:this.done?i.SUCCESS:this.loading?i.LOADING:i.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;e+=`?callback=${this.CALLBACK}`;this.apiKey&&(e+=`&key=${this.apiKey}`);this.channel&&(e+=`&channel=${this.channel}`);this.client&&(e+=`&client=${this.client}`);this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`);this.language&&(e+=`&language=${this.language}`);this.region&&(e+=`&region=${this.region}`);this.version&&(e+=`&v=${this.version}`);this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`);this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`);return e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise(((e,t)=>{this.loadCallback((i=>{i?t(i.error):e(window.google)}))}))}loadCallback(e){this.callbacks.push(e);this.execute()}setScript(){if(document.getElementById(this.id)){this.callback();return}const e=this.createUrl();const t=document.createElement("script");t.id=this.id;t.type="text/javascript";t.src=e;t.onerror=this.loadErrorCallback.bind(this);t.defer=true;t.async=true;this.nonce&&(t.nonce=this.nonce);document.head.appendChild(t)}reset(){this.deleteScript();this.done=false;this.loading=false;this.errors=[];this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){this.errors.push(e);if(this.errors.length<=this.retries){const e=this.errors.length*Math.pow(2,this.errors.length);console.log(`Failed to load Google Maps script, retrying in ${e} ms.`);setTimeout((()=>{this.deleteScript();this.setScript()}),e)}else{this.onerrorEvent=e;this.callback()}}setCallback(){window.__googleMapsCallback=this.callback.bind(this)}callback(){this.done=true;this.loading=false;this.callbacks.forEach((e=>{e(this.onerrorEvent)}));this.callbacks=[]}execute(){this.resetIfRetryingFailed();if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match.");this.callback();return}if(this.loading);else{this.loading=true;this.setCallback();this.setScript()}}}}export{t as DEFAULT_ID,Loader,i as LoaderStatus};

