import*as e from"mdurl";import*as t from"uc.micro";import{decodeHTML as n}from"entities";import r from"linkify-it";import s from"punycode.js";function _class(e){return Object.prototype.toString.call(e)}function isString(e){return _class(e)==="[object String]"}const i=Object.prototype.hasOwnProperty;function has(e,t){return i.call(e,t)}function assign(e){const t=Array.prototype.slice.call(arguments,1);t.forEach((function(t){if(t){if(typeof t!=="object")throw new TypeError(t+"must be object");Object.keys(t).forEach((function(n){e[n]=t[n]}))}}));return e}function arrayReplaceAt(e,t,n){return[].concat(e.slice(0,t),n,e.slice(t+1))}function isValidEntityCode(e){return!(e>=55296&&e<=57343)&&(!(e>=64976&&e<=65007)&&((e&65535)!==65535&&(e&65535)!==65534&&(!(e>=0&&e<=8)&&(e!==11&&(!(e>=14&&e<=31)&&(!(e>=127&&e<=159)&&!(e>1114111)))))))}function fromCodePoint(e){if(e>65535){e-=65536;const t=55296+(e>>10);const n=56320+(e&1023);return String.fromCharCode(t,n)}return String.fromCharCode(e)}const o=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g;const l=/&([a-z#][a-z0-9]{1,31});/gi;const c=new RegExp(o.source+"|"+l.source,"gi");const a=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function replaceEntityPattern(e,t){if(t.charCodeAt(0)===35&&a.test(t)){const n=t[1].toLowerCase()==="x"?parseInt(t.slice(2),16):parseInt(t.slice(1),10);return isValidEntityCode(n)?fromCodePoint(n):e}const r=n(e);return r!==e?r:e}function unescapeMd(e){return e.indexOf("\\")<0?e:e.replace(o,"$1")}function unescapeAll(e){return e.indexOf("\\")<0&&e.indexOf("&")<0?e:e.replace(c,(function(e,t,n){return t||replaceEntityPattern(e,n)}))}const u=/[&<>"]/;const f=/[&<>"]/g;const p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function replaceUnsafeChar(e){return p[e]}function escapeHtml(e){return u.test(e)?e.replace(f,replaceUnsafeChar):e}const h=/[.?*+^$[\]\\(){}|-]/g;function escapeRE(e){return e.replace(h,"\\$&")}function isSpace(e){switch(e){case 9:case 32:return true}return false}function isWhiteSpace(e){if(e>=8192&&e<=8202)return true;switch(e){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return true}return false}function isPunctChar(e){return t.P.test(e)||t.S.test(e)}function isMdAsciiPunct(e){switch(e){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return true;default:return false}}function normalizeReference(e){e=e.trim().replace(/\s+/g," ");"ẞ".toLowerCase()==="Ṿ"&&(e=e.replace(/ẞ/g,"ß"));return e.toLowerCase().toUpperCase()}const k={mdurl:e,ucmicro:t};var d=Object.freeze(Object.defineProperty({__proto__:null,arrayReplaceAt:arrayReplaceAt,assign:assign,escapeHtml:escapeHtml,escapeRE:escapeRE,fromCodePoint:fromCodePoint,has:has,isMdAsciiPunct:isMdAsciiPunct,isPunctChar:isPunctChar,isSpace:isSpace,isString:isString,isValidEntityCode:isValidEntityCode,isWhiteSpace:isWhiteSpace,lib:k,normalizeReference:normalizeReference,unescapeAll:unescapeAll,unescapeMd:unescapeMd},Symbol.toStringTag,{value:"Module"}));function parseLinkLabel(e,t,n){let r,s,i,o;const l=e.posMax;const c=e.pos;e.pos=t+1;r=1;while(e.pos<l){i=e.src.charCodeAt(e.pos);if(i===93){r--;if(r===0){s=true;break}}o=e.pos;e.md.inline.skipToken(e);if(i===91)if(o===e.pos-1)r++;else if(n){e.pos=c;return-1}}let a=-1;s&&(a=e.pos);e.pos=c;return a}function parseLinkDestination(e,t,n){let r;let s=t;const i={ok:false,pos:0,str:""};if(e.charCodeAt(s)===60){s++;while(s<n){r=e.charCodeAt(s);if(r===10)return i;if(r===60)return i;if(r===62){i.pos=s+1;i.str=unescapeAll(e.slice(t+1,s));i.ok=true;return i}r===92&&s+1<n?s+=2:s++}return i}let o=0;while(s<n){r=e.charCodeAt(s);if(r===32)break;if(r<32||r===127)break;if(r===92&&s+1<n){if(e.charCodeAt(s+1)===32)break;s+=2}else{if(r===40){o++;if(o>32)return i}if(r===41){if(o===0)break;o--}s++}}if(t===s)return i;if(o!==0)return i;i.str=unescapeAll(e.slice(t,s));i.pos=s;i.ok=true;return i}function parseLinkTitle(e,t,n,r){let s;let i=t;const o={ok:false,can_continue:false,pos:0,str:"",marker:0};if(r){o.str=r.str;o.marker=r.marker}else{if(i>=n)return o;let r=e.charCodeAt(i);if(r!==34&&r!==39&&r!==40)return o;t++;i++;r===40&&(r=41);o.marker=r}while(i<n){s=e.charCodeAt(i);if(s===o.marker){o.pos=i+1;o.str+=unescapeAll(e.slice(t,i));o.ok=true;return o}if(s===40&&o.marker===41)return o;s===92&&i+1<n&&i++;i++}o.can_continue=true;o.str+=unescapeAll(e.slice(t,i));return o}var m=Object.freeze(Object.defineProperty({__proto__:null,parseLinkDestination:parseLinkDestination,parseLinkLabel:parseLinkLabel,parseLinkTitle:parseLinkTitle},Symbol.toStringTag,{value:"Module"}));const g={};g.code_inline=function(e,t,n,r,s){const i=e[t];return"<code"+s.renderAttrs(i)+">"+escapeHtml(i.content)+"</code>"};g.code_block=function(e,t,n,r,s){const i=e[t];return"<pre"+s.renderAttrs(i)+"><code>"+escapeHtml(e[t].content)+"</code></pre>\n"};g.fence=function(e,t,n,r,s){const i=e[t];const o=i.info?unescapeAll(i.info).trim():"";let l="";let c="";if(o){const e=o.split(/(\s+)/g);l=e[0];c=e.slice(2).join("")}let a;a=n.highlight&&n.highlight(i.content,l,c)||escapeHtml(i.content);if(a.indexOf("<pre")===0)return a+"\n";if(o){const e=i.attrIndex("class");const t=i.attrs?i.attrs.slice():[];if(e<0)t.push(["class",n.langPrefix+l]);else{t[e]=t[e].slice();t[e][1]+=" "+n.langPrefix+l}const r={attrs:t};return`<pre><code${s.renderAttrs(r)}>${a}</code></pre>\n`}return`<pre><code${s.renderAttrs(i)}>${a}</code></pre>\n`};g.image=function(e,t,n,r,s){const i=e[t];i.attrs[i.attrIndex("alt")][1]=s.renderInlineAsText(i.children,n,r);return s.renderToken(e,t,n)};g.hardbreak=function(e,t,n){return n.xhtmlOut?"<br />\n":"<br>\n"};g.softbreak=function(e,t,n){return n.breaks?n.xhtmlOut?"<br />\n":"<br>\n":"\n"};g.text=function(e,t){return escapeHtml(e[t].content)};g.html_block=function(e,t){return e[t].content};g.html_inline=function(e,t){return e[t].content};function Renderer(){this.rules=assign({},g)}Renderer.prototype.renderAttrs=function renderAttrs(e){let t,n,r;if(!e.attrs)return"";r="";for(t=0,n=e.attrs.length;t<n;t++)r+=" "+escapeHtml(e.attrs[t][0])+'="'+escapeHtml(e.attrs[t][1])+'"';return r};Renderer.prototype.renderToken=function renderToken(e,t,n){const r=e[t];let s="";if(r.hidden)return"";r.block&&r.nesting!==-1&&t&&e[t-1].hidden&&(s+="\n");s+=(r.nesting===-1?"</":"<")+r.tag;s+=this.renderAttrs(r);r.nesting===0&&n.xhtmlOut&&(s+=" /");let i=false;if(r.block){i=true;if(r.nesting===1&&t+1<e.length){const n=e[t+1];(n.type==="inline"||n.hidden||n.nesting===-1&&n.tag===r.tag)&&(i=false)}}s+=i?">\n":">";return s};Renderer.prototype.renderInline=function(e,t,n){let r="";const s=this.rules;for(let i=0,o=e.length;i<o;i++){const o=e[i].type;typeof s[o]!=="undefined"?r+=s[o](e,i,t,n,this):r+=this.renderToken(e,i,t)}return r};Renderer.prototype.renderInlineAsText=function(e,t,n){let r="";for(let s=0,i=e.length;s<i;s++)switch(e[s].type){case"text":r+=e[s].content;break;case"image":r+=this.renderInlineAsText(e[s].children,t,n);break;case"html_inline":case"html_block":r+=e[s].content;break;case"softbreak":case"hardbreak":r+="\n";break;default:}return r};Renderer.prototype.render=function(e,t,n){let r="";const s=this.rules;for(let i=0,o=e.length;i<o;i++){const o=e[i].type;o==="inline"?r+=this.renderInline(e[i].children,t,n):typeof s[o]!=="undefined"?r+=s[o](e,i,t,n,this):r+=this.renderToken(e,i,t,n)}return r};function Ruler(){this.__rules__=[];this.__cache__=null}Ruler.prototype.__find__=function(e){for(let t=0;t<this.__rules__.length;t++)if(this.__rules__[t].name===e)return t;return-1};Ruler.prototype.__compile__=function(){const e=this;const t=[""];e.__rules__.forEach((function(e){e.enabled&&e.alt.forEach((function(e){t.indexOf(e)<0&&t.push(e)}))}));e.__cache__={};t.forEach((function(t){e.__cache__[t]=[];e.__rules__.forEach((function(n){n.enabled&&(t&&n.alt.indexOf(t)<0||e.__cache__[t].push(n.fn))}))}))};Ruler.prototype.at=function(e,t,n){const r=this.__find__(e);const s=n||{};if(r===-1)throw new Error("Parser rule not found: "+e);this.__rules__[r].fn=t;this.__rules__[r].alt=s.alt||[];this.__cache__=null};Ruler.prototype.before=function(e,t,n,r){const s=this.__find__(e);const i=r||{};if(s===-1)throw new Error("Parser rule not found: "+e);this.__rules__.splice(s,0,{name:t,enabled:true,fn:n,alt:i.alt||[]});this.__cache__=null};Ruler.prototype.after=function(e,t,n,r){const s=this.__find__(e);const i=r||{};if(s===-1)throw new Error("Parser rule not found: "+e);this.__rules__.splice(s+1,0,{name:t,enabled:true,fn:n,alt:i.alt||[]});this.__cache__=null};Ruler.prototype.push=function(e,t,n){const r=n||{};this.__rules__.push({name:e,enabled:true,fn:t,alt:r.alt||[]});this.__cache__=null};Ruler.prototype.enable=function(e,t){Array.isArray(e)||(e=[e]);const n=[];e.forEach((function(e){const r=this.__find__(e);if(r<0){if(t)return;throw new Error("Rules manager: invalid rule name "+e)}this.__rules__[r].enabled=true;n.push(e)}),this);this.__cache__=null;return n};Ruler.prototype.enableOnly=function(e,t){Array.isArray(e)||(e=[e]);this.__rules__.forEach((function(e){e.enabled=false}));this.enable(e,t)};Ruler.prototype.disable=function(e,t){Array.isArray(e)||(e=[e]);const n=[];e.forEach((function(e){const r=this.__find__(e);if(r<0){if(t)return;throw new Error("Rules manager: invalid rule name "+e)}this.__rules__[r].enabled=false;n.push(e)}),this);this.__cache__=null;return n};Ruler.prototype.getRules=function(e){this.__cache__===null&&this.__compile__();return this.__cache__[e]||[]};function Token(e,t,n){this.type=e;this.tag=t;this.attrs=null;this.map=null;this.nesting=n;this.level=0;this.children=null;this.content="";this.markup="";this.info="";this.meta=null;this.block=false;this.hidden=false}Token.prototype.attrIndex=function attrIndex(e){if(!this.attrs)return-1;const t=this.attrs;for(let n=0,r=t.length;n<r;n++)if(t[n][0]===e)return n;return-1};Token.prototype.attrPush=function attrPush(e){this.attrs?this.attrs.push(e):this.attrs=[e]};Token.prototype.attrSet=function attrSet(e,t){const n=this.attrIndex(e);const r=[e,t];n<0?this.attrPush(r):this.attrs[n]=r};Token.prototype.attrGet=function attrGet(e){const t=this.attrIndex(e);let n=null;t>=0&&(n=this.attrs[t][1]);return n};Token.prototype.attrJoin=function attrJoin(e,t){const n=this.attrIndex(e);n<0?this.attrPush([e,t]):this.attrs[n][1]=this.attrs[n][1]+" "+t};function StateCore(e,t,n){this.src=e;this.env=n;this.tokens=[];this.inlineMode=false;this.md=t}StateCore.prototype.Token=Token;const b=/\r\n?|\n/g;const _=/\0/g;function normalize(e){let t;t=e.src.replace(b,"\n");t=t.replace(_,"�");e.src=t}function block(e){let t;if(e.inlineMode){t=new e.Token("inline","",0);t.content=e.src;t.map=[0,1];t.children=[];e.tokens.push(t)}else e.md.block.parse(e.src,e.md,e.env,e.tokens)}function inline(e){const t=e.tokens;for(let n=0,r=t.length;n<r;n++){const r=t[n];r.type==="inline"&&e.md.inline.parse(r.content,e.md,e.env,r.children)}}function isLinkOpen$1(e){return/^<a[>\s]/i.test(e)}function isLinkClose$1(e){return/^<\/a\s*>/i.test(e)}function linkify$1(e){const t=e.tokens;if(e.md.options.linkify)for(let n=0,r=t.length;n<r;n++){if(t[n].type!=="inline"||!e.md.linkify.pretest(t[n].content))continue;let r=t[n].children;let s=0;for(let i=r.length-1;i>=0;i--){const o=r[i];if(o.type!=="link_close"){if(o.type==="html_inline"){isLinkOpen$1(o.content)&&s>0&&s--;isLinkClose$1(o.content)&&s++}if(!(s>0)&&o.type==="text"&&e.md.linkify.test(o.content)){const s=o.content;let l=e.md.linkify.match(s);const c=[];let a=o.level;let u=0;l.length>0&&l[0].index===0&&i>0&&r[i-1].type==="text_special"&&(l=l.slice(1));for(let t=0;t<l.length;t++){const n=l[t].url;const r=e.md.normalizeLink(n);if(!e.md.validateLink(r))continue;let i=l[t].text;i=l[t].schema?l[t].schema!=="mailto:"||/^mailto:/i.test(i)?e.md.normalizeLinkText(i):e.md.normalizeLinkText("mailto:"+i).replace(/^mailto:/,""):e.md.normalizeLinkText("http://"+i).replace(/^http:\/\//,"");const o=l[t].index;if(o>u){const t=new e.Token("text","",0);t.content=s.slice(u,o);t.level=a;c.push(t)}const f=new e.Token("link_open","a",1);f.attrs=[["href",r]];f.level=a++;f.markup="linkify";f.info="auto";c.push(f);const p=new e.Token("text","",0);p.content=i;p.level=a;c.push(p);const h=new e.Token("link_close","a",-1);h.level=--a;h.markup="linkify";h.info="auto";c.push(h);u=l[t].lastIndex}if(u<s.length){const t=new e.Token("text","",0);t.content=s.slice(u);t.level=a;c.push(t)}t[n].children=r=arrayReplaceAt(r,i,c)}}else{i--;while(r[i].level!==o.level&&r[i].type!=="link_open")i--}}}}const C=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/;const y=/\((c|tm|r)\)/i;const A=/\((c|tm|r)\)/gi;const x={c:"©",r:"®",tm:"™"};function replaceFn(e,t){return x[t.toLowerCase()]}function replace_scoped(e){let t=0;for(let n=e.length-1;n>=0;n--){const r=e[n];r.type!=="text"||t||(r.content=r.content.replace(A,replaceFn));r.type==="link_open"&&r.info==="auto"&&t--;r.type==="link_close"&&r.info==="auto"&&t++}}function replace_rare(e){let t=0;for(let n=e.length-1;n>=0;n--){const r=e[n];r.type!=="text"||t||C.test(r.content)&&(r.content=r.content.replace(/\+-/g,"±").replace(/\.{2,}/g,"…").replace(/([?!])…/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/gm,"$1—").replace(/(^|\s)--(?=\s|$)/gm,"$1–").replace(/(^|[^-\s])--(?=[^-\s]|$)/gm,"$1–"));r.type==="link_open"&&r.info==="auto"&&t--;r.type==="link_close"&&r.info==="auto"&&t++}}function replace(e){let t;if(e.md.options.typographer)for(t=e.tokens.length-1;t>=0;t--)if(e.tokens[t].type==="inline"){y.test(e.tokens[t].content)&&replace_scoped(e.tokens[t].children);C.test(e.tokens[t].content)&&replace_rare(e.tokens[t].children)}}const S=/['"]/;const w=/['"]/g;const M="’";function replaceAt(e,t,n){return e.slice(0,t)+n+e.slice(t+1)}function process_inlines(e,t){let n;const r=[];for(let s=0;s<e.length;s++){const i=e[s];const o=e[s].level;for(n=r.length-1;n>=0;n--)if(r[n].level<=o)break;r.length=n+1;if(i.type!=="text")continue;let l=i.content;let c=0;let a=l.length;e:while(c<a){w.lastIndex=c;const u=w.exec(l);if(!u)break;let f=true;let p=true;c=u.index+1;const h=u[0]==="'";let k=32;if(u.index-1>=0)k=l.charCodeAt(u.index-1);else for(n=s-1;n>=0;n--){if(e[n].type==="softbreak"||e[n].type==="hardbreak")break;if(e[n].content){k=e[n].content.charCodeAt(e[n].content.length-1);break}}let d=32;if(c<a)d=l.charCodeAt(c);else for(n=s+1;n<e.length;n++){if(e[n].type==="softbreak"||e[n].type==="hardbreak")break;if(e[n].content){d=e[n].content.charCodeAt(0);break}}const m=isMdAsciiPunct(k)||isPunctChar(String.fromCharCode(k));const g=isMdAsciiPunct(d)||isPunctChar(String.fromCharCode(d));const b=isWhiteSpace(k);const _=isWhiteSpace(d);_?f=false:g&&(b||m||(f=false));b?p=false:m&&(_||g||(p=false));d===34&&u[0]==='"'&&k>=48&&k<=57&&(p=f=false);if(f&&p){f=m;p=g}if(f||p){if(p)for(n=r.length-1;n>=0;n--){let f=r[n];if(r[n].level<o)break;if(f.single===h&&r[n].level===o){f=r[n];let o;let p;if(h){o=t.md.options.quotes[2];p=t.md.options.quotes[3]}else{o=t.md.options.quotes[0];p=t.md.options.quotes[1]}i.content=replaceAt(i.content,u.index,p);e[f.token].content=replaceAt(e[f.token].content,f.pos,o);c+=p.length-1;f.token===s&&(c+=o.length-1);l=i.content;a=l.length;r.length=n;continue e}}f?r.push({token:s,pos:u.index,single:h,level:o}):p&&h&&(i.content=replaceAt(i.content,u.index,M))}else h&&(i.content=replaceAt(i.content,u.index,M))}}}function smartquotes(e){if(e.md.options.typographer)for(let t=e.tokens.length-1;t>=0;t--)e.tokens[t].type==="inline"&&S.test(e.tokens[t].content)&&process_inlines(e.tokens[t].children,e)}function text_join(e){let t,n;const r=e.tokens;const s=r.length;for(let e=0;e<s;e++){if(r[e].type!=="inline")continue;const s=r[e].children;const i=s.length;for(t=0;t<i;t++)s[t].type==="text_special"&&(s[t].type="text");for(t=n=0;t<i;t++)if(s[t].type==="text"&&t+1<i&&s[t+1].type==="text")s[t+1].content=s[t].content+s[t+1].content;else{t!==n&&(s[n]=s[t]);n++}t!==n&&(s.length=n)}}const L=[["normalize",normalize],["block",block],["inline",inline],["linkify",linkify$1],["replacements",replace],["smartquotes",smartquotes],["text_join",text_join]];function Core(){this.ruler=new Ruler;for(let e=0;e<L.length;e++)this.ruler.push(L[e][0],L[e][1])}Core.prototype.process=function(e){const t=this.ruler.getRules("");for(let n=0,r=t.length;n<r;n++)t[n](e)};Core.prototype.State=StateCore;function StateBlock(e,t,n,r){this.src=e;this.md=t;this.env=n;this.tokens=r;this.bMarks=[];this.eMarks=[];this.tShift=[];this.sCount=[];this.bsCount=[];this.blkIndent=0;this.line=0;this.lineMax=0;this.tight=false;this.ddIndent=-1;this.listIndent=-1;this.parentType="root";this.level=0;const s=this.src;for(let e=0,t=0,n=0,r=0,i=s.length,o=false;t<i;t++){const l=s.charCodeAt(t);if(!o){if(isSpace(l)){n++;l===9?r+=4-r%4:r++;continue}o=true}if(l===10||t===i-1){l!==10&&t++;this.bMarks.push(e);this.eMarks.push(t);this.tShift.push(n);this.sCount.push(r);this.bsCount.push(0);o=false;n=0;r=0;e=t+1}}this.bMarks.push(s.length);this.eMarks.push(s.length);this.tShift.push(0);this.sCount.push(0);this.bsCount.push(0);this.lineMax=this.bMarks.length-1}StateBlock.prototype.push=function(e,t,n){const r=new Token(e,t,n);r.block=true;n<0&&this.level--;r.level=this.level;n>0&&this.level++;this.tokens.push(r);return r};StateBlock.prototype.isEmpty=function isEmpty(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]};StateBlock.prototype.skipEmptyLines=function skipEmptyLines(e){for(let t=this.lineMax;e<t;e++)if(this.bMarks[e]+this.tShift[e]<this.eMarks[e])break;return e};StateBlock.prototype.skipSpaces=function skipSpaces(e){for(let t=this.src.length;e<t;e++){const t=this.src.charCodeAt(e);if(!isSpace(t))break}return e};StateBlock.prototype.skipSpacesBack=function skipSpacesBack(e,t){if(e<=t)return e;while(e>t)if(!isSpace(this.src.charCodeAt(--e)))return e+1;return e};StateBlock.prototype.skipChars=function skipChars(e,t){for(let n=this.src.length;e<n;e++)if(this.src.charCodeAt(e)!==t)break;return e};StateBlock.prototype.skipCharsBack=function skipCharsBack(e,t,n){if(e<=n)return e;while(e>n)if(t!==this.src.charCodeAt(--e))return e+1;return e};StateBlock.prototype.getLines=function getLines(e,t,n,r){if(e>=t)return"";const s=new Array(t-e);for(let i=0,o=e;o<t;o++,i++){let e=0;const l=this.bMarks[o];let c=l;let a;a=o+1<t||r?this.eMarks[o]+1:this.eMarks[o];while(c<a&&e<n){const t=this.src.charCodeAt(c);if(isSpace(t))t===9?e+=4-(e+this.bsCount[o])%4:e++;else{if(!(c-l<this.tShift[o]))break;e++}c++}s[i]=e>n?new Array(e-n+1).join(" ")+this.src.slice(c,a):this.src.slice(c,a)}return s.join("")};StateBlock.prototype.Token=Token;const I=65536;function getLine(e,t){const n=e.bMarks[t]+e.tShift[t];const r=e.eMarks[t];return e.src.slice(n,r)}function escapedSplit(e){const t=[];const n=e.length;let r=0;let s=e.charCodeAt(r);let i=false;let o=0;let l="";while(r<n){if(s===124)if(i){l+=e.substring(o,r-1);o=r}else{t.push(l+e.substring(o,r));l="";o=r+1}i=s===92;r++;s=e.charCodeAt(r)}t.push(l+e.substring(o));return t}function table(e,t,n,r){if(t+2>n)return false;let s=t+1;if(e.sCount[s]<e.blkIndent)return false;if(e.sCount[s]-e.blkIndent>=4)return false;let i=e.bMarks[s]+e.tShift[s];if(i>=e.eMarks[s])return false;const o=e.src.charCodeAt(i++);if(o!==124&&o!==45&&o!==58)return false;if(i>=e.eMarks[s])return false;const l=e.src.charCodeAt(i++);if(l!==124&&l!==45&&l!==58&&!isSpace(l))return false;if(o===45&&isSpace(l))return false;while(i<e.eMarks[s]){const t=e.src.charCodeAt(i);if(t!==124&&t!==45&&t!==58&&!isSpace(t))return false;i++}let c=getLine(e,t+1);let a=c.split("|");const u=[];for(let e=0;e<a.length;e++){const t=a[e].trim();if(!t){if(e===0||e===a.length-1)continue;return false}if(!/^:?-+:?$/.test(t))return false;t.charCodeAt(t.length-1)===58?u.push(t.charCodeAt(0)===58?"center":"right"):t.charCodeAt(0)===58?u.push("left"):u.push("")}c=getLine(e,t).trim();if(c.indexOf("|")===-1)return false;if(e.sCount[t]-e.blkIndent>=4)return false;a=escapedSplit(c);a.length&&a[0]===""&&a.shift();a.length&&a[a.length-1]===""&&a.pop();const f=a.length;if(f===0||f!==u.length)return false;if(r)return true;const p=e.parentType;e.parentType="table";const h=e.md.block.ruler.getRules("blockquote");const k=e.push("table_open","table",1);const d=[t,0];k.map=d;const m=e.push("thead_open","thead",1);m.map=[t,t+1];const g=e.push("tr_open","tr",1);g.map=[t,t+1];for(let t=0;t<a.length;t++){const n=e.push("th_open","th",1);u[t]&&(n.attrs=[["style","text-align:"+u[t]]]);const r=e.push("inline","",0);r.content=a[t].trim();r.children=[];e.push("th_close","th",-1)}e.push("tr_close","tr",-1);e.push("thead_close","thead",-1);let b;let _=0;for(s=t+2;s<n;s++){if(e.sCount[s]<e.blkIndent)break;let r=false;for(let t=0,i=h.length;t<i;t++)if(h[t](e,s,n,true)){r=true;break}if(r)break;c=getLine(e,s).trim();if(!c)break;if(e.sCount[s]-e.blkIndent>=4)break;a=escapedSplit(c);a.length&&a[0]===""&&a.shift();a.length&&a[a.length-1]===""&&a.pop();_+=f-a.length;if(_>I)break;if(s===t+2){const n=e.push("tbody_open","tbody",1);n.map=b=[t+2,0]}const i=e.push("tr_open","tr",1);i.map=[s,s+1];for(let t=0;t<f;t++){const n=e.push("td_open","td",1);u[t]&&(n.attrs=[["style","text-align:"+u[t]]]);const r=e.push("inline","",0);r.content=a[t]?a[t].trim():"";r.children=[];e.push("td_close","td",-1)}e.push("tr_close","tr",-1)}if(b){e.push("tbody_close","tbody",-1);b[1]=s}e.push("table_close","table",-1);d[1]=s;e.parentType=p;e.line=s;return true}function code(e,t,n){if(e.sCount[t]-e.blkIndent<4)return false;let r=t+1;let s=r;while(r<n)if(e.isEmpty(r))r++;else{if(!(e.sCount[r]-e.blkIndent>=4))break;r++;s=r}e.line=s;const i=e.push("code_block","code",0);i.content=e.getLines(t,s,4+e.blkIndent,false)+"\n";i.map=[t,e.line];return true}function fence(e,t,n,r){let s=e.bMarks[t]+e.tShift[t];let i=e.eMarks[t];if(e.sCount[t]-e.blkIndent>=4)return false;if(s+3>i)return false;const o=e.src.charCodeAt(s);if(o!==126&&o!==96)return false;let l=s;s=e.skipChars(s,o);let c=s-l;if(c<3)return false;const a=e.src.slice(l,s);const u=e.src.slice(s,i);if(o===96&&u.indexOf(String.fromCharCode(o))>=0)return false;if(r)return true;let f=t;let p=false;for(;;){f++;if(f>=n)break;s=l=e.bMarks[f]+e.tShift[f];i=e.eMarks[f];if(s<i&&e.sCount[f]<e.blkIndent)break;if(e.src.charCodeAt(s)===o&&!(e.sCount[f]-e.blkIndent>=4)){s=e.skipChars(s,o);if(!(s-l<c)){s=e.skipSpaces(s);if(!(s<i)){p=true;break}}}}c=e.sCount[t];e.line=f+(p?1:0);const h=e.push("fence","code",0);h.info=u;h.content=e.getLines(t+1,f,c,true);h.markup=a;h.map=[t,e.line];return true}function blockquote(e,t,n,r){let s=e.bMarks[t]+e.tShift[t];let i=e.eMarks[t];const o=e.lineMax;if(e.sCount[t]-e.blkIndent>=4)return false;if(e.src.charCodeAt(s)!==62)return false;if(r)return true;const l=[];const c=[];const a=[];const u=[];const f=e.md.block.ruler.getRules("blockquote");const p=e.parentType;e.parentType="blockquote";let h=false;let k;for(k=t;k<n;k++){const t=e.sCount[k]<e.blkIndent;s=e.bMarks[k]+e.tShift[k];i=e.eMarks[k];if(s>=i)break;if(e.src.charCodeAt(s++)===62&&!t){let t=e.sCount[k]+1;let n;let r;if(e.src.charCodeAt(s)===32){s++;t++;r=false;n=true}else if(e.src.charCodeAt(s)===9){n=true;if((e.bsCount[k]+t)%4===3){s++;t++;r=false}else r=true}else n=false;let o=t;l.push(e.bMarks[k]);e.bMarks[k]=s;while(s<i){const t=e.src.charCodeAt(s);if(!isSpace(t))break;t===9?o+=4-(o+e.bsCount[k]+(r?1:0))%4:o++;s++}h=s>=i;c.push(e.bsCount[k]);e.bsCount[k]=e.sCount[k]+1+(n?1:0);a.push(e.sCount[k]);e.sCount[k]=o-t;u.push(e.tShift[k]);e.tShift[k]=s-e.bMarks[k];continue}if(h)break;let r=false;for(let t=0,s=f.length;t<s;t++)if(f[t](e,k,n,true)){r=true;break}if(r){e.lineMax=k;if(e.blkIndent!==0){l.push(e.bMarks[k]);c.push(e.bsCount[k]);u.push(e.tShift[k]);a.push(e.sCount[k]);e.sCount[k]-=e.blkIndent}break}l.push(e.bMarks[k]);c.push(e.bsCount[k]);u.push(e.tShift[k]);a.push(e.sCount[k]);e.sCount[k]=-1}const d=e.blkIndent;e.blkIndent=0;const m=e.push("blockquote_open","blockquote",1);m.markup=">";const g=[t,0];m.map=g;e.md.block.tokenize(e,t,k);const b=e.push("blockquote_close","blockquote",-1);b.markup=">";e.lineMax=o;e.parentType=p;g[1]=e.line;for(let n=0;n<u.length;n++){e.bMarks[n+t]=l[n];e.tShift[n+t]=u[n];e.sCount[n+t]=a[n];e.bsCount[n+t]=c[n]}e.blkIndent=d;return true}function hr(e,t,n,r){const s=e.eMarks[t];if(e.sCount[t]-e.blkIndent>=4)return false;let i=e.bMarks[t]+e.tShift[t];const o=e.src.charCodeAt(i++);if(o!==42&&o!==45&&o!==95)return false;let l=1;while(i<s){const t=e.src.charCodeAt(i++);if(t!==o&&!isSpace(t))return false;t===o&&l++}if(l<3)return false;if(r)return true;e.line=t+1;const c=e.push("hr","hr",0);c.map=[t,e.line];c.markup=Array(l+1).join(String.fromCharCode(o));return true}function skipBulletListMarker(e,t){const n=e.eMarks[t];let r=e.bMarks[t]+e.tShift[t];const s=e.src.charCodeAt(r++);if(s!==42&&s!==45&&s!==43)return-1;if(r<n){const t=e.src.charCodeAt(r);if(!isSpace(t))return-1}return r}function skipOrderedListMarker(e,t){const n=e.bMarks[t]+e.tShift[t];const r=e.eMarks[t];let s=n;if(s+1>=r)return-1;let i=e.src.charCodeAt(s++);if(i<48||i>57)return-1;for(;;){if(s>=r)return-1;i=e.src.charCodeAt(s++);if(!(i>=48&&i<=57)){if(i===41||i===46)break;return-1}if(s-n>=10)return-1}if(s<r){i=e.src.charCodeAt(s);if(!isSpace(i))return-1}return s}function markTightParagraphs(e,t){const n=e.level+2;for(let r=t+2,s=e.tokens.length-2;r<s;r++)if(e.tokens[r].level===n&&e.tokens[r].type==="paragraph_open"){e.tokens[r+2].hidden=true;e.tokens[r].hidden=true;r+=2}}function list(e,t,n,r){let s,i,o,l;let c=t;let a=true;if(e.sCount[c]-e.blkIndent>=4)return false;if(e.listIndent>=0&&e.sCount[c]-e.listIndent>=4&&e.sCount[c]<e.blkIndent)return false;let u=false;r&&e.parentType==="paragraph"&&e.sCount[c]>=e.blkIndent&&(u=true);let f;let p;let h;if((h=skipOrderedListMarker(e,c))>=0){f=true;o=e.bMarks[c]+e.tShift[c];p=Number(e.src.slice(o,h-1));if(u&&p!==1)return false}else{if(!((h=skipBulletListMarker(e,c))>=0))return false;f=false}if(u&&e.skipSpaces(h)>=e.eMarks[c])return false;if(r)return true;const k=e.src.charCodeAt(h-1);const d=e.tokens.length;if(f){l=e.push("ordered_list_open","ol",1);p!==1&&(l.attrs=[["start",p]])}else l=e.push("bullet_list_open","ul",1);const m=[c,0];l.map=m;l.markup=String.fromCharCode(k);let g=false;const b=e.md.block.ruler.getRules("list");const _=e.parentType;e.parentType="list";while(c<n){i=h;s=e.eMarks[c];const t=e.sCount[c]+h-(e.bMarks[c]+e.tShift[c]);let r=t;while(i<s){const t=e.src.charCodeAt(i);if(t===9)r+=4-(r+e.bsCount[c])%4;else{if(t!==32)break;r++}i++}const u=i;let p;p=u>=s?1:r-t;p>4&&(p=1);const d=t+p;l=e.push("list_item_open","li",1);l.markup=String.fromCharCode(k);const m=[c,0];l.map=m;f&&(l.info=e.src.slice(o,h-1));const _=e.tight;const C=e.tShift[c];const y=e.sCount[c];const A=e.listIndent;e.listIndent=e.blkIndent;e.blkIndent=d;e.tight=true;e.tShift[c]=u-e.bMarks[c];e.sCount[c]=r;u>=s&&e.isEmpty(c+1)?e.line=Math.min(e.line+2,n):e.md.block.tokenize(e,c,n,true);e.tight&&!g||(a=false);g=e.line-c>1&&e.isEmpty(e.line-1);e.blkIndent=e.listIndent;e.listIndent=A;e.tShift[c]=C;e.sCount[c]=y;e.tight=_;l=e.push("list_item_close","li",-1);l.markup=String.fromCharCode(k);c=e.line;m[1]=c;if(c>=n)break;if(e.sCount[c]<e.blkIndent)break;if(e.sCount[c]-e.blkIndent>=4)break;let x=false;for(let t=0,r=b.length;t<r;t++)if(b[t](e,c,n,true)){x=true;break}if(x)break;if(f){h=skipOrderedListMarker(e,c);if(h<0)break;o=e.bMarks[c]+e.tShift[c]}else{h=skipBulletListMarker(e,c);if(h<0)break}if(k!==e.src.charCodeAt(h-1))break}l=f?e.push("ordered_list_close","ol",-1):e.push("bullet_list_close","ul",-1);l.markup=String.fromCharCode(k);m[1]=c;e.line=c;e.parentType=_;a&&markTightParagraphs(e,d);return true}function reference(e,t,n,r){let s=e.bMarks[t]+e.tShift[t];let i=e.eMarks[t];let o=t+1;if(e.sCount[t]-e.blkIndent>=4)return false;if(e.src.charCodeAt(s)!==91)return false;function getNextLine(t){const n=e.lineMax;if(t>=n||e.isEmpty(t))return null;let r=false;e.sCount[t]-e.blkIndent>3&&(r=true);e.sCount[t]<0&&(r=true);if(!r){const r=e.md.block.ruler.getRules("reference");const s=e.parentType;e.parentType="reference";let i=false;for(let s=0,o=r.length;s<o;s++)if(r[s](e,t,n,true)){i=true;break}e.parentType=s;if(i)return null}const s=e.bMarks[t]+e.tShift[t];const i=e.eMarks[t];return e.src.slice(s,i+1)}let l=e.src.slice(s,i+1);i=l.length;let c=-1;for(s=1;s<i;s++){const e=l.charCodeAt(s);if(e===91)return false;if(e===93){c=s;break}if(e===10){const e=getNextLine(o);if(e!==null){l+=e;i=l.length;o++}}else if(e===92){s++;if(s<i&&l.charCodeAt(s)===10){const e=getNextLine(o);if(e!==null){l+=e;i=l.length;o++}}}}if(c<0||l.charCodeAt(c+1)!==58)return false;for(s=c+2;s<i;s++){const e=l.charCodeAt(s);if(e===10){const e=getNextLine(o);if(e!==null){l+=e;i=l.length;o++}}else if(!isSpace(e))break}const a=e.md.helpers.parseLinkDestination(l,s,i);if(!a.ok)return false;const u=e.md.normalizeLink(a.str);if(!e.md.validateLink(u))return false;s=a.pos;const f=s;const p=o;const h=s;for(;s<i;s++){const e=l.charCodeAt(s);if(e===10){const e=getNextLine(o);if(e!==null){l+=e;i=l.length;o++}}else if(!isSpace(e))break}let k=e.md.helpers.parseLinkTitle(l,s,i);while(k.can_continue){const t=getNextLine(o);if(t===null)break;l+=t;s=i;i=l.length;o++;k=e.md.helpers.parseLinkTitle(l,s,i,k)}let d;if(s<i&&h!==s&&k.ok){d=k.str;s=k.pos}else{d="";s=f;o=p}while(s<i){const e=l.charCodeAt(s);if(!isSpace(e))break;s++}if(s<i&&l.charCodeAt(s)!==10&&d){d="";s=f;o=p;while(s<i){const e=l.charCodeAt(s);if(!isSpace(e))break;s++}}if(s<i&&l.charCodeAt(s)!==10)return false;const m=normalizeReference(l.slice(1,c));if(!m)return false;if(r)return true;typeof e.env.references==="undefined"&&(e.env.references={});typeof e.env.references[m]==="undefined"&&(e.env.references[m]={title:d,href:u});e.line=o;return true}var v=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"];const T="[a-zA-Z_:][a-zA-Z0-9:._-]*";const z="[^\"'=<>`\\x00-\\x20]+";const P="'[^']*'";const E='"[^"]*"';const R="(?:"+z+"|"+P+"|"+E+")";const $="(?:\\s+"+T+"(?:\\s*=\\s*"+R+")?)";const O="<[A-Za-z][A-Za-z0-9\\-]*"+$+"*\\s*\\/?>";const j="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>";const q="\x3c!---?>|\x3c!--(?:[^-]|-[^-]|--[^>])*--\x3e";const B="<[?][\\s\\S]*?[?]>";const Z="<![A-Za-z][^>]*>";const D="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>";const N=new RegExp("^(?:"+O+"|"+j+"|"+q+"|"+B+"|"+Z+"|"+D+")");const H=new RegExp("^(?:"+O+"|"+j+")");const W=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,true],[/^<!--/,/-->/,true],[/^<\?/,/\?>/,true],[/^<![A-Z]/,/>/,true],[/^<!\[CDATA\[/,/\]\]>/,true],[new RegExp("^</?("+v.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,true],[new RegExp(H.source+"\\s*$"),/^$/,false]];function html_block(e,t,n,r){let s=e.bMarks[t]+e.tShift[t];let i=e.eMarks[t];if(e.sCount[t]-e.blkIndent>=4)return false;if(!e.md.options.html)return false;if(e.src.charCodeAt(s)!==60)return false;let o=e.src.slice(s,i);let l=0;for(;l<W.length;l++)if(W[l][0].test(o))break;if(l===W.length)return false;if(r)return W[l][2];let c=t+1;if(!W[l][1].test(o))for(;c<n;c++){if(e.sCount[c]<e.blkIndent)break;s=e.bMarks[c]+e.tShift[c];i=e.eMarks[c];o=e.src.slice(s,i);if(W[l][1].test(o)){o.length!==0&&c++;break}}e.line=c;const a=e.push("html_block","",0);a.map=[t,c];a.content=e.getLines(t,c,e.blkIndent,true);return true}function heading(e,t,n,r){let s=e.bMarks[t]+e.tShift[t];let i=e.eMarks[t];if(e.sCount[t]-e.blkIndent>=4)return false;let o=e.src.charCodeAt(s);if(o!==35||s>=i)return false;let l=1;o=e.src.charCodeAt(++s);while(o===35&&s<i&&l<=6){l++;o=e.src.charCodeAt(++s)}if(l>6||s<i&&!isSpace(o))return false;if(r)return true;i=e.skipSpacesBack(i,s);const c=e.skipCharsBack(i,35,s);c>s&&isSpace(e.src.charCodeAt(c-1))&&(i=c);e.line=t+1;const a=e.push("heading_open","h"+String(l),1);a.markup="########".slice(0,l);a.map=[t,e.line];const u=e.push("inline","",0);u.content=e.src.slice(s,i).trim();u.map=[t,e.line];u.children=[];const f=e.push("heading_close","h"+String(l),-1);f.markup="########".slice(0,l);return true}function lheading(e,t,n){const r=e.md.block.ruler.getRules("paragraph");if(e.sCount[t]-e.blkIndent>=4)return false;const s=e.parentType;e.parentType="paragraph";let i=0;let o;let l=t+1;for(;l<n&&!e.isEmpty(l);l++){if(e.sCount[l]-e.blkIndent>3)continue;if(e.sCount[l]>=e.blkIndent){let t=e.bMarks[l]+e.tShift[l];const n=e.eMarks[l];if(t<n){o=e.src.charCodeAt(t);if(o===45||o===61){t=e.skipChars(t,o);t=e.skipSpaces(t);if(t>=n){i=o===61?1:2;break}}}}if(e.sCount[l]<0)continue;let t=false;for(let s=0,i=r.length;s<i;s++)if(r[s](e,l,n,true)){t=true;break}if(t)break}if(!i)return false;const c=e.getLines(t,l,e.blkIndent,false).trim();e.line=l+1;const a=e.push("heading_open","h"+String(i),1);a.markup=String.fromCharCode(o);a.map=[t,e.line];const u=e.push("inline","",0);u.content=c;u.map=[t,e.line-1];u.children=[];const f=e.push("heading_close","h"+String(i),-1);f.markup=String.fromCharCode(o);e.parentType=s;return true}function paragraph(e,t,n){const r=e.md.block.ruler.getRules("paragraph");const s=e.parentType;let i=t+1;e.parentType="paragraph";for(;i<n&&!e.isEmpty(i);i++){if(e.sCount[i]-e.blkIndent>3)continue;if(e.sCount[i]<0)continue;let t=false;for(let s=0,o=r.length;s<o;s++)if(r[s](e,i,n,true)){t=true;break}if(t)break}const o=e.getLines(t,i,e.blkIndent,false).trim();e.line=i;const l=e.push("paragraph_open","p",1);l.map=[t,e.line];const c=e.push("inline","",0);c.content=o;c.map=[t,e.line];c.children=[];e.push("paragraph_close","p",-1);e.parentType=s;return true}const V=[["table",table,["paragraph","reference"]],["code",code],["fence",fence,["paragraph","reference","blockquote","list"]],["blockquote",blockquote,["paragraph","reference","blockquote","list"]],["hr",hr,["paragraph","reference","blockquote","list"]],["list",list,["paragraph","reference","blockquote"]],["reference",reference],["html_block",html_block,["paragraph","reference","blockquote"]],["heading",heading,["paragraph","reference","blockquote"]],["lheading",lheading],["paragraph",paragraph]];function ParserBlock(){this.ruler=new Ruler;for(let e=0;e<V.length;e++)this.ruler.push(V[e][0],V[e][1],{alt:(V[e][2]||[]).slice()})}ParserBlock.prototype.tokenize=function(e,t,n){const r=this.ruler.getRules("");const s=r.length;const i=e.md.options.maxNesting;let o=t;let l=false;while(o<n){e.line=o=e.skipEmptyLines(o);if(o>=n)break;if(e.sCount[o]<e.blkIndent)break;if(e.level>=i){e.line=n;break}const t=e.line;let c=false;for(let i=0;i<s;i++){c=r[i](e,o,n,false);if(c){if(t>=e.line)throw new Error("block rule didn't increment state.line");break}}if(!c)throw new Error("none of the block rules matched");e.tight=!l;e.isEmpty(e.line-1)&&(l=true);o=e.line;if(o<n&&e.isEmpty(o)){l=true;o++;e.line=o}}};ParserBlock.prototype.parse=function(e,t,n,r){if(!e)return;const s=new this.State(e,t,n,r);this.tokenize(s,s.line,s.lineMax)};ParserBlock.prototype.State=StateBlock;function StateInline(e,t,n,r){this.src=e;this.env=n;this.md=t;this.tokens=r;this.tokens_meta=Array(r.length);this.pos=0;this.posMax=this.src.length;this.level=0;this.pending="";this.pendingLevel=0;this.cache={};this.delimiters=[];this._prev_delimiters=[];this.backticks={};this.backticksScanned=false;this.linkLevel=0}StateInline.prototype.pushPending=function(){const e=new Token("text","",0);e.content=this.pending;e.level=this.pendingLevel;this.tokens.push(e);this.pending="";return e};StateInline.prototype.push=function(e,t,n){this.pending&&this.pushPending();const r=new Token(e,t,n);let s=null;if(n<0){this.level--;this.delimiters=this._prev_delimiters.pop()}r.level=this.level;if(n>0){this.level++;this._prev_delimiters.push(this.delimiters);this.delimiters=[];s={delimiters:this.delimiters}}this.pendingLevel=this.level;this.tokens.push(r);this.tokens_meta.push(s);return r};StateInline.prototype.scanDelims=function(e,t){const n=this.posMax;const r=this.src.charCodeAt(e);const s=e>0?this.src.charCodeAt(e-1):32;let i=e;while(i<n&&this.src.charCodeAt(i)===r)i++;const o=i-e;const l=i<n?this.src.charCodeAt(i):32;const c=isMdAsciiPunct(s)||isPunctChar(String.fromCharCode(s));const a=isMdAsciiPunct(l)||isPunctChar(String.fromCharCode(l));const u=isWhiteSpace(s);const f=isWhiteSpace(l);const p=!f&&(!a||u||c);const h=!u&&(!c||f||a);const k=p&&(t||!h||c);const d=h&&(t||!p||a);return{can_open:k,can_close:d,length:o}};StateInline.prototype.Token=Token;function isTerminatorChar(e){switch(e){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return true;default:return false}}function text(e,t){let n=e.pos;while(n<e.posMax&&!isTerminatorChar(e.src.charCodeAt(n)))n++;if(n===e.pos)return false;t||(e.pending+=e.src.slice(e.pos,n));e.pos=n;return true}const F=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function linkify(e,t){if(!e.md.options.linkify)return false;if(e.linkLevel>0)return false;const n=e.pos;const r=e.posMax;if(n+3>r)return false;if(e.src.charCodeAt(n)!==58)return false;if(e.src.charCodeAt(n+1)!==47)return false;if(e.src.charCodeAt(n+2)!==47)return false;const s=e.pending.match(F);if(!s)return false;const i=s[1];const o=e.md.linkify.matchAtStart(e.src.slice(n-i.length));if(!o)return false;let l=o.url;if(l.length<=i.length)return false;l=l.replace(/\*+$/,"");const c=e.md.normalizeLink(l);if(!e.md.validateLink(c))return false;if(!t){e.pending=e.pending.slice(0,-i.length);const t=e.push("link_open","a",1);t.attrs=[["href",c]];t.markup="linkify";t.info="auto";const n=e.push("text","",0);n.content=e.md.normalizeLinkText(l);const r=e.push("link_close","a",-1);r.markup="linkify";r.info="auto"}e.pos+=l.length-i.length;return true}function newline(e,t){let n=e.pos;if(e.src.charCodeAt(n)!==10)return false;const r=e.pending.length-1;const s=e.posMax;if(!t)if(r>=0&&e.pending.charCodeAt(r)===32)if(r>=1&&e.pending.charCodeAt(r-1)===32){let t=r-1;while(t>=1&&e.pending.charCodeAt(t-1)===32)t--;e.pending=e.pending.slice(0,t);e.push("hardbreak","br",0)}else{e.pending=e.pending.slice(0,-1);e.push("softbreak","br",0)}else e.push("softbreak","br",0);n++;while(n<s&&isSpace(e.src.charCodeAt(n)))n++;e.pos=n;return true}const U=[];for(let e=0;e<256;e++)U.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach((function(e){U[e.charCodeAt(0)]=1}));function escape(e,t){let n=e.pos;const r=e.posMax;if(e.src.charCodeAt(n)!==92)return false;n++;if(n>=r)return false;let s=e.src.charCodeAt(n);if(s===10){t||e.push("hardbreak","br",0);n++;while(n<r){s=e.src.charCodeAt(n);if(!isSpace(s))break;n++}e.pos=n;return true}let i=e.src[n];if(s>=55296&&s<=56319&&n+1<r){const t=e.src.charCodeAt(n+1);if(t>=56320&&t<=57343){i+=e.src[n+1];n++}}const o="\\"+i;if(!t){const t=e.push("text_special","",0);s<256&&U[s]!==0?t.content=i:t.content=o;t.markup=o;t.info="escape"}e.pos=n+1;return true}function backtick(e,t){let n=e.pos;const r=e.src.charCodeAt(n);if(r!==96)return false;const s=n;n++;const i=e.posMax;while(n<i&&e.src.charCodeAt(n)===96)n++;const o=e.src.slice(s,n);const l=o.length;if(e.backticksScanned&&(e.backticks[l]||0)<=s){t||(e.pending+=o);e.pos+=l;return true}let c=n;let a;while((a=e.src.indexOf("`",c))!==-1){c=a+1;while(c<i&&e.src.charCodeAt(c)===96)c++;const r=c-a;if(r===l){if(!t){const t=e.push("code_inline","code",0);t.markup=o;t.content=e.src.slice(n,a).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}e.pos=c;return true}e.backticks[r]=a}e.backticksScanned=true;t||(e.pending+=o);e.pos+=l;return true}function strikethrough_tokenize(e,t){const n=e.pos;const r=e.src.charCodeAt(n);if(t)return false;if(r!==126)return false;const s=e.scanDelims(e.pos,true);let i=s.length;const o=String.fromCharCode(r);if(i<2)return false;let l;if(i%2){l=e.push("text","",0);l.content=o;i--}for(let t=0;t<i;t+=2){l=e.push("text","",0);l.content=o+o;e.delimiters.push({marker:r,length:0,token:e.tokens.length-1,end:-1,open:s.can_open,close:s.can_close})}e.pos+=s.length;return true}function postProcess$1(e,t){let n;const r=[];const s=t.length;for(let i=0;i<s;i++){const s=t[i];if(s.marker!==126)continue;if(s.end===-1)continue;const o=t[s.end];n=e.tokens[s.token];n.type="s_open";n.tag="s";n.nesting=1;n.markup="~~";n.content="";n=e.tokens[o.token];n.type="s_close";n.tag="s";n.nesting=-1;n.markup="~~";n.content="";e.tokens[o.token-1].type==="text"&&e.tokens[o.token-1].content==="~"&&r.push(o.token-1)}while(r.length){const t=r.pop();let s=t+1;while(s<e.tokens.length&&e.tokens[s].type==="s_close")s++;s--;if(t!==s){n=e.tokens[s];e.tokens[s]=e.tokens[t];e.tokens[t]=n}}}function strikethrough_postProcess(e){const t=e.tokens_meta;const n=e.tokens_meta.length;postProcess$1(e,e.delimiters);for(let r=0;r<n;r++)t[r]&&t[r].delimiters&&postProcess$1(e,t[r].delimiters)}var G={tokenize:strikethrough_tokenize,postProcess:strikethrough_postProcess};function emphasis_tokenize(e,t){const n=e.pos;const r=e.src.charCodeAt(n);if(t)return false;if(r!==95&&r!==42)return false;const s=e.scanDelims(e.pos,r===42);for(let t=0;t<s.length;t++){const t=e.push("text","",0);t.content=String.fromCharCode(r);e.delimiters.push({marker:r,length:s.length,token:e.tokens.length-1,end:-1,open:s.can_open,close:s.can_close})}e.pos+=s.length;return true}function postProcess(e,t){const n=t.length;for(let r=n-1;r>=0;r--){const n=t[r];if(n.marker!==95&&n.marker!==42)continue;if(n.end===-1)continue;const s=t[n.end];const i=r>0&&t[r-1].end===n.end+1&&t[r-1].marker===n.marker&&t[r-1].token===n.token-1&&t[n.end+1].token===s.token+1;const o=String.fromCharCode(n.marker);const l=e.tokens[n.token];l.type=i?"strong_open":"em_open";l.tag=i?"strong":"em";l.nesting=1;l.markup=i?o+o:o;l.content="";const c=e.tokens[s.token];c.type=i?"strong_close":"em_close";c.tag=i?"strong":"em";c.nesting=-1;c.markup=i?o+o:o;c.content="";if(i){e.tokens[t[r-1].token].content="";e.tokens[t[n.end+1].token].content="";r--}}}function emphasis_post_process(e){const t=e.tokens_meta;const n=e.tokens_meta.length;postProcess(e,e.delimiters);for(let r=0;r<n;r++)t[r]&&t[r].delimiters&&postProcess(e,t[r].delimiters)}var J={tokenize:emphasis_tokenize,postProcess:emphasis_post_process};function link(e,t){let n,r,s,i;let o="";let l="";let c=e.pos;let a=true;if(e.src.charCodeAt(e.pos)!==91)return false;const u=e.pos;const f=e.posMax;const p=e.pos+1;const h=e.md.helpers.parseLinkLabel(e,e.pos,true);if(h<0)return false;let k=h+1;if(k<f&&e.src.charCodeAt(k)===40){a=false;k++;for(;k<f;k++){n=e.src.charCodeAt(k);if(!isSpace(n)&&n!==10)break}if(k>=f)return false;c=k;s=e.md.helpers.parseLinkDestination(e.src,k,e.posMax);if(s.ok){o=e.md.normalizeLink(s.str);e.md.validateLink(o)?k=s.pos:o="";c=k;for(;k<f;k++){n=e.src.charCodeAt(k);if(!isSpace(n)&&n!==10)break}s=e.md.helpers.parseLinkTitle(e.src,k,e.posMax);if(k<f&&c!==k&&s.ok){l=s.str;k=s.pos;for(;k<f;k++){n=e.src.charCodeAt(k);if(!isSpace(n)&&n!==10)break}}}(k>=f||e.src.charCodeAt(k)!==41)&&(a=true);k++}if(a){if(typeof e.env.references==="undefined")return false;if(k<f&&e.src.charCodeAt(k)===91){c=k+1;k=e.md.helpers.parseLinkLabel(e,k);k>=0?r=e.src.slice(c,k++):k=h+1}else k=h+1;r||(r=e.src.slice(p,h));i=e.env.references[normalizeReference(r)];if(!i){e.pos=u;return false}o=i.href;l=i.title}if(!t){e.pos=p;e.posMax=h;const t=e.push("link_open","a",1);const n=[["href",o]];t.attrs=n;l&&n.push(["title",l]);e.linkLevel++;e.md.inline.tokenize(e);e.linkLevel--;e.push("link_close","a",-1)}e.pos=k;e.posMax=f;return true}function image(e,t){let n,r,s,i,o,l,c,a;let u="";const f=e.pos;const p=e.posMax;if(e.src.charCodeAt(e.pos)!==33)return false;if(e.src.charCodeAt(e.pos+1)!==91)return false;const h=e.pos+2;const k=e.md.helpers.parseLinkLabel(e,e.pos+1,false);if(k<0)return false;i=k+1;if(i<p&&e.src.charCodeAt(i)===40){i++;for(;i<p;i++){n=e.src.charCodeAt(i);if(!isSpace(n)&&n!==10)break}if(i>=p)return false;a=i;l=e.md.helpers.parseLinkDestination(e.src,i,e.posMax);if(l.ok){u=e.md.normalizeLink(l.str);e.md.validateLink(u)?i=l.pos:u=""}a=i;for(;i<p;i++){n=e.src.charCodeAt(i);if(!isSpace(n)&&n!==10)break}l=e.md.helpers.parseLinkTitle(e.src,i,e.posMax);if(i<p&&a!==i&&l.ok){c=l.str;i=l.pos;for(;i<p;i++){n=e.src.charCodeAt(i);if(!isSpace(n)&&n!==10)break}}else c="";if(i>=p||e.src.charCodeAt(i)!==41){e.pos=f;return false}i++}else{if(typeof e.env.references==="undefined")return false;if(i<p&&e.src.charCodeAt(i)===91){a=i+1;i=e.md.helpers.parseLinkLabel(e,i);i>=0?s=e.src.slice(a,i++):i=k+1}else i=k+1;s||(s=e.src.slice(h,k));o=e.env.references[normalizeReference(s)];if(!o){e.pos=f;return false}u=o.href;c=o.title}if(!t){r=e.src.slice(h,k);const t=[];e.md.inline.parse(r,e.md,e.env,t);const n=e.push("image","img",0);const s=[["src",u],["alt",""]];n.attrs=s;n.children=t;n.content=r;c&&s.push(["title",c])}e.pos=i;e.posMax=p;return true}const K=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/;const Q=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function autolink(e,t){let n=e.pos;if(e.src.charCodeAt(n)!==60)return false;const r=e.pos;const s=e.posMax;for(;;){if(++n>=s)return false;const t=e.src.charCodeAt(n);if(t===60)return false;if(t===62)break}const i=e.src.slice(r+1,n);if(Q.test(i)){const n=e.md.normalizeLink(i);if(!e.md.validateLink(n))return false;if(!t){const t=e.push("link_open","a",1);t.attrs=[["href",n]];t.markup="autolink";t.info="auto";const r=e.push("text","",0);r.content=e.md.normalizeLinkText(i);const s=e.push("link_close","a",-1);s.markup="autolink";s.info="auto"}e.pos+=i.length+2;return true}if(K.test(i)){const n=e.md.normalizeLink("mailto:"+i);if(!e.md.validateLink(n))return false;if(!t){const t=e.push("link_open","a",1);t.attrs=[["href",n]];t.markup="autolink";t.info="auto";const r=e.push("text","",0);r.content=e.md.normalizeLinkText(i);const s=e.push("link_close","a",-1);s.markup="autolink";s.info="auto"}e.pos+=i.length+2;return true}return false}function isLinkOpen(e){return/^<a[>\s]/i.test(e)}function isLinkClose(e){return/^<\/a\s*>/i.test(e)}function isLetter(e){const t=e|32;return t>=97&&t<=122}function html_inline(e,t){if(!e.md.options.html)return false;const n=e.posMax;const r=e.pos;if(e.src.charCodeAt(r)!==60||r+2>=n)return false;const s=e.src.charCodeAt(r+1);if(s!==33&&s!==63&&s!==47&&!isLetter(s))return false;const i=e.src.slice(r).match(N);if(!i)return false;if(!t){const t=e.push("html_inline","",0);t.content=i[0];isLinkOpen(t.content)&&e.linkLevel++;isLinkClose(t.content)&&e.linkLevel--}e.pos+=i[0].length;return true}const X=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i;const Y=/^&([a-z][a-z0-9]{1,31});/i;function entity(e,t){const r=e.pos;const s=e.posMax;if(e.src.charCodeAt(r)!==38)return false;if(r+1>=s)return false;const i=e.src.charCodeAt(r+1);if(i===35){const n=e.src.slice(r).match(X);if(n){if(!t){const t=n[1][0].toLowerCase()==="x"?parseInt(n[1].slice(1),16):parseInt(n[1],10);const r=e.push("text_special","",0);r.content=isValidEntityCode(t)?fromCodePoint(t):fromCodePoint(65533);r.markup=n[0];r.info="entity"}e.pos+=n[0].length;return true}}else{const s=e.src.slice(r).match(Y);if(s){const r=n(s[0]);if(r!==s[0]){if(!t){const t=e.push("text_special","",0);t.content=r;t.markup=s[0];t.info="entity"}e.pos+=s[0].length;return true}}}return false}function processDelimiters(e){const t={};const n=e.length;if(!n)return;let r=0;let s=-2;const i=[];for(let o=0;o<n;o++){const n=e[o];i.push(0);e[r].marker===n.marker&&s===n.token-1||(r=o);s=n.token;n.length=n.length||0;if(!n.close)continue;t.hasOwnProperty(n.marker)||(t[n.marker]=[-1,-1,-1,-1,-1,-1]);const l=t[n.marker][(n.open?3:0)+n.length%3];let c=r-i[r]-1;let a=c;for(;c>l;c-=i[c]+1){const t=e[c];if(t.marker===n.marker&&(t.open&&t.end<0)){let r=false;(t.close||n.open)&&(t.length+n.length)%3===0&&(t.length%3===0&&n.length%3===0||(r=true));if(!r){const r=c>0&&!e[c-1].open?i[c-1]+1:0;i[o]=o-c+r;i[c]=r;n.open=false;t.end=o;t.close=false;a=-1;s=-2;break}}}a!==-1&&(t[n.marker][(n.open?3:0)+(n.length||0)%3]=a)}}function link_pairs(e){const t=e.tokens_meta;const n=e.tokens_meta.length;processDelimiters(e.delimiters);for(let e=0;e<n;e++)t[e]&&t[e].delimiters&&processDelimiters(t[e].delimiters)}function fragments_join(e){let t,n;let r=0;const s=e.tokens;const i=e.tokens.length;for(t=n=0;t<i;t++){s[t].nesting<0&&r--;s[t].level=r;s[t].nesting>0&&r++;if(s[t].type==="text"&&t+1<i&&s[t+1].type==="text")s[t+1].content=s[t].content+s[t+1].content;else{t!==n&&(s[n]=s[t]);n++}}t!==n&&(s.length=n)}const ee=[["text",text],["linkify",linkify],["newline",newline],["escape",escape],["backticks",backtick],["strikethrough",G.tokenize],["emphasis",J.tokenize],["link",link],["image",image],["autolink",autolink],["html_inline",html_inline],["entity",entity]];const te=[["balance_pairs",link_pairs],["strikethrough",G.postProcess],["emphasis",J.postProcess],["fragments_join",fragments_join]];function ParserInline(){this.ruler=new Ruler;for(let e=0;e<ee.length;e++)this.ruler.push(ee[e][0],ee[e][1]);this.ruler2=new Ruler;for(let e=0;e<te.length;e++)this.ruler2.push(te[e][0],te[e][1])}ParserInline.prototype.skipToken=function(e){const t=e.pos;const n=this.ruler.getRules("");const r=n.length;const s=e.md.options.maxNesting;const i=e.cache;if(typeof i[t]!=="undefined"){e.pos=i[t];return}let o=false;if(e.level<s)for(let s=0;s<r;s++){e.level++;o=n[s](e,true);e.level--;if(o){if(t>=e.pos)throw new Error("inline rule didn't increment state.pos");break}}else e.pos=e.posMax;o||e.pos++;i[t]=e.pos};ParserInline.prototype.tokenize=function(e){const t=this.ruler.getRules("");const n=t.length;const r=e.posMax;const s=e.md.options.maxNesting;while(e.pos<r){const i=e.pos;let o=false;if(e.level<s)for(let r=0;r<n;r++){o=t[r](e,false);if(o){if(i>=e.pos)throw new Error("inline rule didn't increment state.pos");break}}if(o){if(e.pos>=r)break}else e.pending+=e.src[e.pos++]}e.pending&&e.pushPending()};ParserInline.prototype.parse=function(e,t,n,r){const s=new this.State(e,t,n,r);this.tokenize(s);const i=this.ruler2.getRules("");const o=i.length;for(let e=0;e<o;e++)i[e](s)};ParserInline.prototype.State=StateInline;var ne={options:{html:false,xhtmlOut:false,breaks:false,langPrefix:"language-",linkify:false,typographer:false,quotes:"“”‘’",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}};var re={options:{html:false,xhtmlOut:false,breaks:false,langPrefix:"language-",linkify:false,typographer:false,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}};var se={options:{html:true,xhtmlOut:true,breaks:false,langPrefix:"language-",linkify:false,typographer:false,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}};const ie={default:ne,zero:re,commonmark:se};const oe=/^(vbscript|javascript|file|data):/;const le=/^data:image\/(gif|png|jpeg|webp);/;function validateLink(e){const t=e.trim().toLowerCase();return!oe.test(t)||le.test(t)}const ce=["http:","https:","mailto:"];function normalizeLink(t){const n=e.parse(t,true);if(n.hostname&&(!n.protocol||ce.indexOf(n.protocol)>=0))try{n.hostname=s.toASCII(n.hostname)}catch(e){}return e.encode(e.format(n))}function normalizeLinkText(t){const n=e.parse(t,true);if(n.hostname&&(!n.protocol||ce.indexOf(n.protocol)>=0))try{n.hostname=s.toUnicode(n.hostname)}catch(e){}return e.decode(e.format(n),e.decode.defaultChars+"%")}function MarkdownIt(e,t){if(!(this instanceof MarkdownIt))return new MarkdownIt(e,t);if(!t&&!isString(e)){t=e||{};e="default"}this.inline=new ParserInline;this.block=new ParserBlock;this.core=new Core;this.renderer=new Renderer;this.linkify=new r;this.validateLink=validateLink;this.normalizeLink=normalizeLink;this.normalizeLinkText=normalizeLinkText;this.utils=d;this.helpers=assign({},m);this.options={};this.configure(e);t&&this.set(t)}MarkdownIt.prototype.set=function(e){assign(this.options,e);return this};MarkdownIt.prototype.configure=function(e){const t=this;if(isString(e)){const t=e;e=ie[t];if(!e)throw new Error('Wrong `markdown-it` preset "'+t+'", check name')}if(!e)throw new Error("Wrong `markdown-it` preset, can't be empty");e.options&&t.set(e.options);e.components&&Object.keys(e.components).forEach((function(n){e.components[n].rules&&t[n].ruler.enableOnly(e.components[n].rules);e.components[n].rules2&&t[n].ruler2.enableOnly(e.components[n].rules2)}));return this};MarkdownIt.prototype.enable=function(e,t){let n=[];Array.isArray(e)||(e=[e]);["core","block","inline"].forEach((function(t){n=n.concat(this[t].ruler.enable(e,true))}),this);n=n.concat(this.inline.ruler2.enable(e,true));const r=e.filter((function(e){return n.indexOf(e)<0}));if(r.length&&!t)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+r);return this};MarkdownIt.prototype.disable=function(e,t){let n=[];Array.isArray(e)||(e=[e]);["core","block","inline"].forEach((function(t){n=n.concat(this[t].ruler.disable(e,true))}),this);n=n.concat(this.inline.ruler2.disable(e,true));const r=e.filter((function(e){return n.indexOf(e)<0}));if(r.length&&!t)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+r);return this};MarkdownIt.prototype.use=function(e){const t=[this].concat(Array.prototype.slice.call(arguments,1));e.apply(e,t);return this};MarkdownIt.prototype.parse=function(e,t){if(typeof e!=="string")throw new Error("Input data should be a String");const n=new this.core.State(e,this,t);this.core.process(n);return n.tokens};MarkdownIt.prototype.render=function(e,t){t=t||{};return this.renderer.render(this.parse(e,t),this.options,t)};MarkdownIt.prototype.parseInline=function(e,t){const n=new this.core.State(e,this,t);n.inlineMode=true;this.core.process(n);return n.tokens};MarkdownIt.prototype.renderInline=function(e,t){t=t||{};return this.renderer.render(this.parseInline(e,t),this.options,t)};export{MarkdownIt as default};

