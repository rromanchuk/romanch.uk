<%= provide(:page_title, 'Most recent batch files') %>
<section class="row row-cols-2 row-cols-md-4 g-4">
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">Pending batches</p>
        <p class="card-text h5 text-warning"><%= number_with_delimiter(Tds::Batch.pending.count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">Completed</p>
        <p class="card-text h5 text-success"><%= number_with_delimiter(Tds::Batch.complete.count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">PIREPs</p>
        <p class="card-text h5 text-success"><%= tag.span number_with_delimiter(Tds::Pirep.cached_count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">AIREPs</p>
        <p class="card-text h5 text-success"><%= tag.span number_with_delimiter(Tds::Airep.count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">METARs</p>
        <p class="card-text h5 text-success"><%= tag.span number_with_delimiter(Tds::Metar.cached_count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">TAFs</p>
        <p class="card-text h5 text-success"><%= tag.span number_with_delimiter(Tds::Taf.cached_count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">Current Etags</p>
        <p class="card-text h6 text-success"><%= ar_etag%></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">Failed Processing</p>
        <p class="card-text h5 text-danger"><%= tag.span number_with_delimiter(Tds::Batch.failed.count) %></p>
      </div>
    </div>
  </div>
  <div class="mt-3 d-grid gap-2 d-md-flex">
    <%= button_to "1. Ingest", ingest_tds_batches_path, method: :put, class: "btn btn-sm btn-primary", data: {turbo_method: :put} %>
    <%= button_to "2. Process", process_csv_tds_batches_path, method: :put, class: "btn btn-sm btn-primary", data: {turbo_method: :put} %>
  </div>
</section>
<%= turbo_stream_from :batches %>
<div class="card">
  <div class="card-header">
    <select 
        class="form-select w-25"
        data-controller="select"
        data-action="select#change">
      <option value="<%= wx_batches_path %>">All</option>
      <option <%= params[:filter] == 'pireps' ? 'selected' : ''%> value="<%= tds_batches_path(filter: 'pireps') %>">PIREPs</option>
      <option value="<%= tds_batches_path(filter: 'metars') %>">METARs</option>
      <option value="<%= tds_batches_path(filter: 'tafs') %>">TAFs</option>
      <option value="<%= tds_batches_path(filter: 'failed') %>">Failed</option>
      <option value="<%= tds_batches_path(filter: 'pending') %>">Pending</option>
    </select>
  </div>
  <%= turbo_frame_tag :batches do %>
    <div class="card-body">
      <%= render partial: "tds/batches/batch", collection: batches, cached: true %>
    </div>
    <div class="card-footer text-muted">
      <%== pagy_bootstrap_nav(dr_pagy, link_extra: "data-turbo-action='advance'") %>
    </div>
  <% end %>
</div>
