<%= provide(:page_title, 'Most recent batch files') %>

<section class="row row-cols-2 row-cols-md-4 g-4">
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">Pending batches</p>
        <p class="card-text h5 text-warning"><%= number_with_delimiter(Wx::Batch.pending.count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">Completed</p>
        <p class="card-text h5 text-success"><%= number_with_delimiter(Wx::Batch.complete.count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">PIREPs</p>
        <p class="card-text h5 text-success"><%= tag.span number_with_delimiter(Wx::Pirep.count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">AIREPs</p>
        <p class="card-text h5 text-success"><%= tag.span number_with_delimiter(Wx::Airep.count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">METARs</p>
        <p class="card-text h5 text-success"><%= tag.span number_with_delimiter(Wx::Metar.count) %></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">Current Etags</p>
        <p class="card-text h6 text-success"><%= ar_etag%></p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="width: 10rem;">
      <div class="card-body text-center">
        <p class="card-title">Failed Redis Set</p>
        <p class="card-text h5 text-danger"><%= failed_redis_set_size %></p>
      </div>
    </div>
  </div>
  <div class="mt-3 d-grid gap-2 d-md-flex">
    <%= button_to "1. Ingest", ingest_wx_batches_path, method: :put, class: "btn btn-sm btn-primary", data: {turbo_method: :put} %>
    <%= button_to "2. Process", process_csv_wx_batches_path, method: :put, class: "btn btn-sm btn-primary", data: {turbo_method: :put} %>
  </div>
</section>



<%= turbo_stream_from :batches %>

<%= turbo_frame_tag :batches do %>
  <div class="card">
    <div class="card-header">
      <select 
        class="form-select w-25"
        data-controller="select"
        data-action="select#change">
        <option value="<%= wx_batches_path %>">All</option>
        <option <%= params[:filter] == 'pireps' ? 'selected' : ''%> value="<%= wx_batches_path(filter: 'pireps') %>">PIREPs</option>
        <option value="<%= wx_batches_path(filter: 'metars') %>">METARs</option>
        <option value="<%= wx_batches_path(filter: 'tafs') %>">TAFs</option>
      </select>
    </div>
    <div class="card-body">
      <%= render partial: "wx/batches/batch", collection: batches, cached: true %>
    </div>
    <div class="card-footer text-muted">
      <%# Helper Dependency Updated: Sep 14, 2022 at 4pm %>
      <%= render PagerComponent.new(dr_pagy, previous_path: wx_batches_path(page: dr_pagy.prev, filter: params[:filter]), next_path: wx_batches_path(page: dr_pagy.next, filter: params[:filter])) %>
    </div>
  </div>
<% end %>





